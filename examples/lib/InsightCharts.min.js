/*! InsightCharts 10-04-2014 */
function Group(a){this._data=a,this._cumulative=!1,this._valueAccessor=function(a){return a},this._orderFunction=function(a,b){return b.value-a.value},this._ordered=!1}function SimpleGroup(a){this._data=a,this._orderFunction=function(a,b){return b.values-a.values}}function NestedGroup(a,b){this._dimension=a,this._data=a.Dimension.bottom(1/0),this._nestFunction=b,this._nestedData=b.entries(this._data)}function Legend(a,b,c,d){BaseChart.call(this,a,b,c,d);this.dataset=function(){return this.group},this.init=function(){this.createChart();var a=this.chart.selectAll(".legend").data(this.dataset()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+(20*b+5*b)+")"});a.append("rect").attr("x",0).attr("width",20).attr("height",20).attr("rx",10).attr("ry",10).style("fill",function(a){return a.color}),a.append("text").attr("x",25).attr("y",10).attr("dy",".35em").text(function(a){return a.label})},this.draw=function(){}}function DataTable(a,b,c,d){BaseChart.call(this,a,b,c,d);this._columns=[],this.chart=d3.select(this.element).append("table").attr("class","dataTable"),this.columns=function(a){return arguments.length?(this._columns=a,this):this._columns},this.init=function(){var a=this;this.header=this.chart.append("thead").append("tr"),this.header.append("th").attr("class","blank").html(""),this.header.selectAll("th.column").data(this._columns).enter().append("th").attr("class","column").html(function(a){return a.label}),this.rows=this.chart.selectAll("tr.datarow").data(this.dataset()),this.rows.enter().append("tr").attr("class","datarow"),this.rows.append("th").html(function(b){return a._keyAccessor(b)}),this.cells=this.rows.selectAll("td").data(function(b){return a._columns.map(function(a){return{column:a,value:a.formatter(a.calculation(b))}})});var b=this.cells.enter();b.append("td").html(function(a){return a.value})},this.draw=function(){var a=this;this.rows=this.chart.selectAll("tr.datarow").data(this.dataset()),this.rows.enter().append("tr").attr("class","datarow"),this.cells=this.rows.selectAll("td").data(function(b){return a._columns.map(function(a){return{column:a,value:a.formatter(a.calculation(b))}})}),this.cells.enter().append("td"),this.cells.html(function(a){return a.value}),this.cells.exit().remove(),this.rows.exit().remove()}}function GroupedBarChart(a,b,c,d){BaseChart.call(this,a,b,c,d);var e=this;this.groupNames=[],this.x=d3.scale.ordinal(),this.subX=d3.scale.ordinal(),this.y=d3.scale.linear(),this.xFormatFunc=function(a){return a},this.color=d3.scale.ordinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00"]),this.yAxis=d3.svg.axis().scale(this.y).orient("left").tickSize(0).tickPadding(10),this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickSize(0).tickPadding(10).tickFormat(function(a){return e.xFormatFunc(a)}),this.xAxisFormat=function(a){return this.xFormatFunc=a,this},this.labelAnchoring=function(){return this.invert()?"start":"end"},this.groupNames=function(a){return arguments?(this._groupNames=a,this):this._groupNames},this.yScaleMax=function(){var a=d3.max(this.dataset(),function(a){var b=0;return b=b<a.value.Total?a.value.Total:b});return a},this.initializeAxes=function(){this.x.domain(this.keys()).rangeRoundBands([0,this.width()-this.margin().left-this.margin().right],.2),this.subX.domain(this._groupNames).rangeRoundBands([0,this.x.rangeBand()],.1),this.y.domain([0,this.yScaleMax()]).range([this.height()-this.margin().top-this.margin().bottom,0])},this.init=function(){var a=this;this.createChart(),this.initializeAxes();var b=this.chart.selectAll(".group").data(this.dataset()).enter().append("g").attr("class","group").attr("transform",function(b){return"translate("+a.x(a._keyAccessor(b))+",0)"}),c=b.append("rect").attr("class","total").attr("width",this.x.rangeBand()).attr("x",0).attr("y",function(b){return a.y(b.value.Total)}).attr("height",function(b){return a.height()-a.margin().top-a.margin().bottom-a.y(b.value.Total)}).attr("fill","silver").on("mouseover",function(b){a.mouseOver(a,this,b)}).on("mouseout",function(b){a.mouseOut(a,this,b)});c.append("svg:text").text(function(){return a.tooltipLabel()}).attr("class","tipLabel"),c.append("svg:text").text(function(b){return a._tooltipFormat(b.value.Total)}).attr("class","tipValue");var d=b.selectAll("rect.subbar").data(function(a){var b=[];for(var c in a.value.Groups)b.push({key:c,value:a.value.Groups[c].Value});return b});d.enter().append("rect").attr("class","subbar").attr("width",this.subX.rangeBand()).attr("x",function(b){return a.subX(b.key)}).attr("y",function(b){return a.y(b.value)}).attr("height",function(b){return a.height()-a.margin().top-a.margin().bottom-a.y(b.value)}).attr("fill",function(b){return a.color(b.key)}).on("mouseover",function(b){a.mouseOver(a,this,b)}).on("mouseout",function(b){a.mouseOut(a,this,b)}),d.append("svg:text").text(function(b){return a._tooltipFormat(a._valueAccessor(b))}).attr("class","tipValue"),d.append("svg:text").text(function(){return a.tooltipLabel()}).attr("class","tipLabel"),this.chart.append("g").call(this.yAxis).selectAll("text").style("text-anchor","end").style("font-size","12px").style("fill","#333"),this.chart.append("g").attr("transform","translate(0,"+(a.height()-a.margin().bottom-a.margin().top)+")").call(this.xAxis).selectAll("text").style("text-anchor","end").style("font-size","12px").style("fill","#333").attr("transform",function(){return"rotate(-90,0,15)"}).on("click",function(b){return a.filterClick(this,b)});var e=this.chart.selectAll(".legend").data(this._groupNames).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+20*b+")"});e.append("rect").attr("x",this.width()-this.margin().right/2).attr("width",18).attr("height",18).style("fill",this.color),e.append("text").attr("x",this.width()-this.margin().right/2-10).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a})},this.draw=function(){var a=this,b=this.chart.selectAll("g.group").data(this.dataset());b.selectAll("rect.total").transition().duration(a.duration).attr("y",function(b){return a.y(b.value.Total)}).attr("height",function(b){return a.height()-a.margin().top-a.margin().bottom-a.y(b.value.Total)}),b.selectAll("rect.subbar").data(function(a){var b=[];for(var c in a.value.Groups)b.push({key:c,value:a.value.Groups[c].Value});return b}).transition().duration(a.duration).attr("y",function(b){return a.y(b.value)}).attr("height",function(b){return a.height()-a.margin().top-a.margin().bottom-a.y(b.value)})}}function StackedBarChart(a,b,c,d){BaseChart.call(this,a,b,c,d);var e=this;this.xFormatFunc=function(a){return a};var f=function(a){e.mouseOver(e,this,a)},g=function(a){e.mouseOut(e,this,a)};this.xAxisFormat=function(a){return this.xFormatFunc=a,this},this.calculateYPos=function(a,b){return b.yPos||(b.yPos=0),b.yPos+=a(b),b.yPos},this.yPosition=function(a){return this.y(this.calculateYPos(this._valueAccessor,a))}.bind(this),this.init=function(){var a=this;this.createChart(),this.initializeAxes(),this.yAxis=d3.svg.axis().scale(this.y).orient("left").tickSize(0).tickFormat(function(b){return a._yAxisFormat(b)}),this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickSize(0).tickFormat(function(b){return a.xFormatFunc(b)}),this.zoomable()&&(this.chart.append("clipPath").attr("id","clip").append("rect").attr("x",0).attr("y",0).attr("width",this.width()).attr("height",this.yDomain()),this.zoom=d3.behavior.zoom().on("zoom",this.dragging),this.zoom.x(this.x),this.chart.append("rect").attr("class","pane").attr("width",this.width()).attr("height",this.yDomain()).on("click",a.clickEvent).style("fill","none").style("pointer-events","all").call(this.zoom));var b=this.chart.selectAll("g").data(this.dataset());b.enter().append("g").attr("class","bargroup");var c=b.selectAll("rect.bar");for(var d in this._series)this._valueAccessor=this.cumulative()?a._series[d].cumulative:a._series[d].calculation,c=b.append("rect").attr("class",a._series[d].name+"class bar").attr("x",this.xPosition).attr("y",this.yPosition).attr("width",this.barWidth).attr("height",this.barHeight).attr("fill",this._series[d].color).attr("clip-path","url(#clip)").on("mouseover",f).on("mouseout",g),c.append("svg:text").text(this.tooltipText).attr("class","tipValue"),c.append("svg:text").text(this._series[d].label).attr("class","tipLabel");this.chart.append("g").attr("class","y-axis").call(this.yAxis).selectAll("text").attr("class","axis-text"),this.chart.append("g").attr("class","x-axis").attr("transform","translate(0,"+(a.height()-a.margin().bottom-a.margin().top)+")").call(this.xAxis).selectAll("text").attr("class","x-axis axis-text").style("text-anchor","start").attr("transform","rotate(90)").attr("dx","10").attr("dy","0").on("mouseover",this.setHover).on("mouseout",this.removeHover).on("click",function(b){return a.filterClick(this,b)}),this._targets&&this.drawTargets()},this.draw=function(a){var b=this;a&&b.redrawAxes()&&this.y.domain([0,d3.round(b.findMax(),1)]).range([this.height()-this.margin().top-this.margin().bottom,0]);var c=this.chart.selectAll("g.bargroup").data(this.dataset()).each(function(a){a.yPos=0});for(var d in this._series){this._valueAccessor=this.cumulative()?b._series[d].cumulative:b._series[d].calculation;var e=a?0:this.animationDuration,f=c.selectAll("."+b._series[d].name+"class.bar").transition().duration(e).attr("x",this.xPosition).attr("y",this.yPosition).attr("width",this.barWidth).attr("height",this.barHeight);f.selectAll("text.tipValue").text(this.tooltipText),f.selectAll("text.tipLabel").text(this._series[d].label)}this._targets&&this.updateTargets(a);var g=this.chart.selectAll("g.x-axis").call(this.xAxis);g.selectAll("text").style("text-anchor","start").attr("transform","rotate(90)").attr("dx","10").attr("dy","0").on("mouseover",this.setHover).on("mouseout",this.removeHover).on("click",function(a){return b.filterClick(this,a)}),g.selectAll("text:not(.selected)").attr("class","x-axis axis-text"),this.chart.selectAll(".y-axis").call(this.yAxis).selectAll("text").attr("class","axis-text")},this.drawTargets=function(){var a=this.chart.selectAll("g").data(this.targetData());if(this._targets){this._targetAccessor=this.cumulative()?e._targets.cumulative:e._targets.calculation;var b=a.append("rect").attr("class",this._targets.name+"class target").attr("x",this.targetX).attr("y",this.targetY).attr("width",this.targetWidth).attr("height",4).attr("fill",this._targets.color).attr("clip-path","url(#clip)").on("mouseover",f).on("mouseout",g);b.append("svg:text").text(this.targetTooltipText).attr("class","tipValue"),b.append("svg:text").text(this._targets.label).attr("class","tipLabel")}},this.updateTargets=function(a){var b=this.chart.selectAll("g.bargroup").data(this.targetData());if(this._targets){this._valueAccessor=this.cumulative()?e._targets.cumulative:e._targets.calculation;var c=b.selectAll("rect."+e._targets.name+"class.target"),d=a?0:this.animationDuration;c.transition().duration(d).attr("x",this.targetX).attr("width",this.targetWidth).attr("y",this.targetY),c.selectAll("text.tipValue").text(this.targetTooltipText).attr("class","tipValue")}},this.dragging=function(){e.draw(!0)}}function TimeLine(a,b,c,d){BaseChart.call(this,a,b,c,d);this.maxRange=d3.max(this.dataset(),function(a){return a.value}),this.range=[this.dimension.Dimension.bottom(1)[0].Date,this.dimension.Dimension.top(1)[0].Date],this.brushColor=function(a){return arguments.length?(this._brushColor=a,this):this._brushColor},this.initializeAxes=function(){this.x=d3.scale.linear().domain([0,this.maxRange]).range([0,this.width()-this.margin().right-this.margin().left]),this.y=d3.time.scale().domain(this.range).range([0,this.height()]),this.yAxis=d3.svg.axis().scale(this.y).tickSize(0).orient("right")},this.display=function(){var a=this,b=a.brush.extent()[0],c=a.brush.extent()[1],d={name:"timeline",filterFunction:function(a){return a>=b&&c>=a}};String(b)!=String(c)?(this.oldFilter&&this.filterEvent(this.dimension,this.oldFilter),this.filterEvent(this.dimension,d),this.oldFilter=d,a.mini.select(".brush").call(a.brush.extent([b,c]))):this.filterEvent(this.dimension,this.oldFilter)},this.init=function(){var a=this;this.createChart(),this.initializeAxes(),this.mini=this.chart.append("g").attr("width",this.width).attr("height",this.height).attr("class","mini"),this.brush=d3.svg.brush().y(this.y).on("brush",function(){a.display()}),a.mini.append("g").selectAll(".miniItems").data(this.dataset()).enter().append("rect").attr("class","minitems").attr("x",60).attr("y",function(b){return a.y(a._keyAccessor(b))}).attr("width",function(b){return a.x(a._valueAccessor(b)-a.margin().right-a.margin().left)}).attr("height",3).attr("fill",a._barColor),a.mini.append("g").attr("class","y axis").style("font-size","11px").call(a.yAxis),a.mini.append("g").attr("class","x brush").call(a.brush).selectAll("rect").attr("width",a.width()).attr("fill",a._brushColor).style("opacity","0.5")},this.draw=function(){var a=this;a.chart.selectAll("rect.mini").data(this.dataset()).transition().duration(a.duration).attr("y",function(b){return a.y(a._keyAccessor(b))}).attr("width",function(b){return a.x(a._valueAccessor(b))})}}function TimelineChart(a,b,c){BaseChart.call(this,name,a,null,null);var d=this;this.values=c,this.key=b,this.dataset=function(){return this.values},this.longdrag=!1,this.drag=d3.behavior.drag().on("drag",function(){d3.select(this).attr("y",this.y.baseVal.value+d3.event.dy).attr("height",this.height.baseVal.value-d3.event.dy).classed("active",!0)}).on("dragend",function(a){d.updatedEntryHandler.call(this,d.key,a,Math.round(d.y.invert(this.y.baseVal.value))),d3.select(this).classed("active",!1)}),this.updatedEntryHandler=function(){d.draw()},this.newEntryHandler=function(){},this.clickEvent=function(){if(!d.longdrag){var a=d3.mouse(this),b=d.x.invert(a[0]);b=new Date(b.getFullYear(),b.getMonth(),1,1,0,0);var c=Math.round(d.y.invert(a[1]));d.newEntryHandler(d.key,b,c)}clearTimeout(d.timeout),d.longdrag=!1},this.keys=function(){var a=this.dataset().map(function(a){return new Date(a.Date)});return a},this.initializeAxes=function(){this.x=d3.time.scale(),this.y=d3.scale.linear();var a=this.findMax();a=a?a+10:10;this.keys();this.x.domain([new Date(2013,0,1),new Date(2015,0,1)]).range([0,this.xDomain()]),this.y.domain([0,a]).rangeRound([this.yDomain(),0]),this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickSize(0).tickPadding(6),this.yAxis=d3.svg.axis().scale(this.y).tickSize(0).orient("left").tickPadding(10),this.zoom=d3.behavior.zoom().on("zoom",this.dragging),this.zoom.x(this.x)},this.dragging=function(){d.timeout=setTimeout(function(){d.longdrag=!0},100),d.draw()},this.init=function(){this.createChart(),this._currentMax=this.findMax(),this.initializeAxes(),$.each(this.dataset(),function(a,b){b.Date=new Date(b.Date)}),this.chart.append("clipPath").attr("id","clip").append("rect").attr("x",0).attr("y",0).attr("width",this.width()).attr("height",this.yDomain()),this.chart.append("g").attr("class","x axis").attr("transform","translate(0,"+(d.height()-d.margin().bottom-d.margin().top)+")"),this.chart.append("g").attr("class","y axis").attr("transform","translate(0,0)"),this.chart.append("rect").attr("class","pane").attr("width",this.width()).attr("height",this.yDomain()).on("click",d.clickEvent).style("fill","none").style("pointer-events","all").call(this.zoom),this.draw()},this.draw=function(){var a=(d.dataset(),d.findMax());a=a?a+10:10,d.y.domain([0,a]),d.chart.select("g.x.axis").call(d.xAxis).selectAll("text").style("font-size","12px"),d.chart.select("g.y.axis").call(d.yAxis).selectAll("text").style("font-size","12px");var b=d.chart.selectAll("rect.item").data(d.dataset()).enter().append("rect").attr("class","item").attr("fill","#ACC3EE");b.append("svg:text").text(this.tooltipText).attr("class","tipValue"),b.append("svg:text").text(this._tooltipLabel).attr("class","tipLabel"),d.chart.selectAll("rect.item").data(d.dataset()).attr("class","item").attr("y",function(a){var b=d.y(d._valueAccessor(a));return b}).attr("height",d.barHeight).attr("x",function(a){var b=d.x(a.Date);return b}).attr("width",function(a){var b=new Date(a.Date.getFullYear(),a.Date.getMonth()+1,1),c=d.x(b)-d.x(a.Date);return c}).on("mouseover",function(){d.mouseOver(d,this)}).on("mouseout",function(){d.mouseOut(d,this)}).attr("clip-path","url(#clip)").call(d.drag).transition().duration(500);this.chart.selectAll("text.tipValue").data(this.dataset()).text(this.tooltipText)}}function PartitionChart(a,b,c,d){this.element=b,this.group=d;var e=1120,f=600,g=d3.scale.linear().range([0,e]),h=d3.scale.linear().range([0,f]);this.vis=d3.select(this.element).append("div").attr("class","chart").style("width",e+"px").style("height",f+"px").append("svg:svg").attr("width",e).attr("height",f),this.partition=d3.layout.partition().children(function(a){return a.values}).value(function(a){return a.ProjectedRevenue}),this.init=function(){function a(a){return"translate(8,"+a.dx*j/2+")"}function b(b){if(b.children){i=(b.y?e-40:e)/(1-b.y),j=f/b.dx,g.domain([b.y,1]).range([b.y?40:0,e]),h.domain([b.x,b.x+b.dx]);var c=d.transition().duration(d3.event.altKey?7500:750).attr("transform",function(a){return"translate("+g(a.y)+","+h(a.x)+")"});c.select("rect").attr("width",b.dy*i).attr("height",function(a){return a.dx*j}),c.select("text").attr("transform",a).style("opacity",function(a){return a.dx*j>12?1:0}),d3.event.stopPropagation()}}var c=this,d=this.vis.selectAll("g").data(c.partition.nodes(this.group())).enter().append("svg:g").attr("transform",function(a){return"translate("+g(a.y)+","+h(a.x)+")"}).on("click",b),i=e/this.group().dx,j=f/1;d.append("svg:rect").attr("width",this.group().dy*i).attr("height",function(a){return a.dx*j}).attr("class",function(a){return a.children?"parent":"child"}).attr("fill","rgb(135, 158, 192)").style("stroke","#fff"),d.append("svg:text").attr("transform",a).attr("dy",".35em").attr("dx","2em").attr("fill","#ecf0f1").style("font-size","13px").style("opacity",function(a){return a.dx*j>12?1:0}).text(function(a){return a.key})}}Group.prototype.filterFunction=function(a){return arguments.length?(this._filterFunction=a,this):this._filterFunction},Group.prototype.cumulative=function(a){return arguments.length?(this._cumulative=a,this):this._cumulative},Group.prototype.getData=function(){var a;return a=this._data.all?this._data.all():this._data,this._filterFunction&&(a=a.filter(this._filterFunction)),a},Group.prototype.getOrderedData=function(){var a;return a=this._data.all?a=this._data.top(1/0).sort(this.orderFunction()):this._data.sort(this.orderFunction()),this._filterFunction&&(a=a.filter(this._filterFunction)),a},Group.prototype.computeFunction=function(a){return this._ordered=!0,arguments.length?(this._compute=a,this):this._compute},Group.prototype.orderFunction=function(a){return arguments.length?(this._orderFunction=a,this):this._orderFunction},Group.prototype.compute=function(){this._compute()},Group.prototype.valueAccessor=function(a){return arguments.length?(this._valueAccessor=a,this):this._valueAccessor},Group.prototype.calculateTotals=function(){if(this._cumulative){var a={},b=0,c=this,d=this._ordered?this.getOrderedData():this.getData();d.forEach(function(d){var e=c._valueAccessor(d);if("object"!=typeof e)b+=e,d.Cumulative=b;else for(var f in e){var g=f+"Cumulative";a[g]?(a[g]+=e[f],e[g]=a[g]):(a[g]=e[f],e[g]=a[g])}})}return this},SimpleGroup.prototype=Object.create(Group.prototype),SimpleGroup.prototype.constructor=SimpleGroup,SimpleGroup.prototype.getOrderedData=function(){return this._data.sort(this._orderFunction)},SimpleGroup.prototype.getData=function(){return this._data},NestedGroup.prototype=Object.create(Group.prototype),NestedGroup.prototype.constructor=NestedGroup,NestedGroup.prototype.getData=function(){return this._nestedData},NestedGroup.prototype.updateNestedData=function(){this._data=this._dimension.Dimension.bottom(1/0),this._nestedData=this._nestFunction.entries(this._data)},NestedGroup.prototype.getOrderedData=function(){return this._nestedData};var Dimension=function(a,b,c){this.Dimension=b,this.Name=a,this.Filters=ko.observableArray(),this.Keys=this.Dimension.group().all().map(function(a){return a.key}),this.displayFunction=c?c:function(a){return a},this.comparer=function(a){return a.Name==this.Name}.bind(this)},ChartGroup=function(a){this.Name=a,this.Charts=ko.observableArray(),this.Dimensions=ko.observableArray(),this.FilteredDimensions=ko.observableArray(),this.Groups=ko.observableArray(),this.CumulativeGroups=ko.observableArray(),this.ComputedGroups=ko.observableArray(),this.LinkedCharts=[],this.NestedGroups=ko.observableArray()};ChartGroup.prototype.initCharts=function(){this.Charts().forEach(function(a){a.init()})},ChartGroup.prototype.addChart=function(a){return a.filterEvent=this.chartFilterHandler.bind(this),a.triggerRedraw=this.redrawCharts.bind(this),this.Charts.push(a),a},ChartGroup.prototype.addDimension=function(a,b,c,d){var e=new Dimension(b,a.dimension(c),d);return this.Dimensions.push(e),e},ChartGroup.prototype.compareFilters=function(a){return function(b){return String(b.name)==String(a.name)}},ChartGroup.prototype.chartFilterHandler=function(a,b){var c=this;if(b){var d=this.Dimensions().filter(a.comparer),e=this.FilteredDimensions().filter(a.comparer);e.length||this.FilteredDimensions.push(a),d3.select(b.element).classed("selected",!0);var f=this.compareFilters(b);d.map(function(a){var d=a.Filters().filter(f).length;d?(a.Filters.remove(f),d3.select(b.element).classed("selected",!1)):a.Filters.push(b);a.Filters();0===a.Filters().length?(c.FilteredDimensions.remove(a),a.Dimension.filterAll()):a.Dimension.filter(function(b){var c=a.Filters().map(function(a){return a.filterFunction(b)});return c.filter(function(a){return a}).length})}),this.NestedGroups().forEach(function(a){a.updateNestedData()}),this.ComputedGroups().forEach(function(a){a.compute()}),this.CumulativeGroups().forEach(function(a){a.calculateTotals()}),this.redrawCharts()}},ChartGroup.prototype.redrawCharts=function(){for(var a=0;a<this.Charts().length;a++)this.Charts()[a].draw()},ChartGroup.prototype.addSumGrouping=function(a,b){var c=a.Dimension.group().reduceSum(b),d=new Group(c);return this.Groups.push(d),d},ChartGroup.prototype.addCustomGrouping=function(a){return this.Groups.push(a),a.cumulative()&&this.CumulativeGroups.push(a),a},ChartGroup.prototype.multiReduceSum=function(a,b){var c=a.Dimension.group().reduce(function(a,c){for(var d in b)c.hasOwnProperty(b[d])&&(a[b[d]]+=c[b[d]]);return a},function(a,c){for(var d in b)c.hasOwnProperty(b[d])&&(a[b[d]]-=c[b[d]]);return a},function(){var a={};for(var c in b)a[b[c]]=0;return a}),d=new Group(c);return this.Groups.push(d),d},ChartGroup.prototype.multiReduceCount=function(a,b){var c=a.Dimension.group().reduce(function(a,c){return a.hasOwnProperty(c[b])?a[c[b]]+=1:a[c[b]]=1,a.Total+=1,a},function(a,c){return c.hasOwnProperty(properties[b])&&(a[c[b]]-=1),a.Total--,a},function(){return{Total:0}}),d=new Group(c);return this.Groups.push(d),d};var BaseChart=function(a,b,c,d){this.element=b,this.dimension=c,this.group=d,this._name=a,this._displayName=a,this.x=d3.scale.ordinal(),this.y=d3.scale.linear(),this._currentMax=0,this._cumulative=!1,this._labelFontSize="11px",this._targets=null,this._series=[],this._ranges=[],this._redrawAxes=!1,this.isFiltered=!1,this._barPadding=.2,this.duration=400,this.filters=[],this._labelPadding=20,this.hasTooltip=!1,this._tooltipText="",this._invert=!1,this._barColor="#acc3ee",this._ordered=!1,this._linkedCharts=[],this._xRangeType=this.x.rangeRoundBands,this._yRangeType=this.y.range,this._barWidthFunction=this.x.rangeBand,this._margin={top:0,bottom:0,left:0,right:0},this._keyAccessor=function(a){return a.key},this._valueAccessor=function(a){return a.value},this._targetAccessor=function(a){return a.value},this._rangeAccessor=function(a){return a.value},this._limitFunction=function(){return!0},this._labelAccessor=function(a){return a.key},this._tooltipFormat=function(a){return a},this._yAxisFormat=function(a){return a},this._xAxisFormat=function(a){return a},this.xPosition=function(a){var b=Math.round(this._barWidthFunction==this.x.rangeBand||this._barWidthFunction==this.x.rangeRound?0:this.barWidth(a)/2);return this.x(this._keyAccessor(a))-b}.bind(this),this.yPosition=function(a){return this.y(this._valueAccessor(a))}.bind(this),this.rangeY=function(a){return this.y(this._rangeAccessor(a))}.bind(this),this.animationDuration=function(a,b){return this.duration+50*b}.bind(this),this.rangeX=function(a,b){var c=b==this.keys().length-1?this._barWidthFunction(a):0;return this.x(this._keyAccessor(a))+c}.bind(this),this.barWidth=function(a){return this._barWidthFunction(a)}.bind(this),this.barHeight=function(a){return this.height()-this.margin().top-this.margin().bottom-this.y(this._valueAccessor(a))}.bind(this),this.targetY=function(a){return this.y(this._targetAccessor(a))}.bind(this),this.targetX=function(a){var b=this._barWidthFunction==this.x.rangeBand?0:this.barWidth(a)/2;return this.x(this._keyAccessor(a))+this._barWidthFunction(a)/3-b}.bind(this),this.targetWidth=function(a){return this._barWidthFunction(a)/3}.bind(this),this.targetTooltipText=function(a){return this._tooltipFormat(this._targetAccessor(a))}.bind(this),this.tooltipText=function(a){return this._tooltipFormat(this._valueAccessor(a))}.bind(this),this.yDomain=function(){return this.height()-this.margin().top-this.margin().bottom}.bind(this),this.xDomain=function(){return this.width()-this.margin().left-this.margin().right}.bind(this)};BaseChart.prototype.zoomable=function(a){return arguments.length?(this._zoomable=a,this):this._zoomable},BaseChart.prototype.displayName=function(a){return arguments.length?(this._displayName=a,this):this._displayName},BaseChart.prototype.width=function(a){return arguments.length?(this._width=a,this):this._width},BaseChart.prototype.height=function(a){return arguments.length?(this._height=a,this):this._height},BaseChart.prototype.orderable=function(a){return arguments.length?(this._orderable=a,this):this._orderable},BaseChart.prototype.ordered=function(a){return arguments.length?(this._ordered=a,this):this._ordered},BaseChart.prototype.orderChildren=function(a){return arguments.length?(this._orderChildren=a,this):this._orderChildren},BaseChart.prototype.y=function(a){return arguments.length?(this._y=a,this):this._y},BaseChart.prototype.x=function(a){return arguments.length?(this._x=a,this):this._x},BaseChart.prototype.setXAxisRange=function(a){return this._xRangeType=a(this.x),this},BaseChart.prototype.initializeAxes=function(){this.initializeXAxis(this),this.initializeYAxis(this)},BaseChart.prototype.xDomainRange=function(){return this.keys()},BaseChart.prototype.initializeYAxis=function(a){this.applyYAxisRange.call(a.y.domain([0,a.findMax()]),a,a._yRangeType)},BaseChart.prototype.initializeXAxis=function(a){this.applyXAxisRange.call(a.x.domain(a.xDomainRange()),a,a._xRangeType)},BaseChart.prototype.applyXAxisRange=function(a,b){b.apply(this,[[0,a.xDomain()],a.barPadding()])},BaseChart.prototype.applyYAxisRange=function(a,b){b.apply(this,[[a.yDomain(),0],0])},BaseChart.prototype.link=function(a,b){return-1==this._linkedCharts.indexOf(a)&&(this._linkedCharts.push(a),b&&this._linkedCharts.forEach(function(b){b.link(a,!1)})),this},BaseChart.prototype.cumulative=function(a){return arguments.length?(this._cumulative=a,this):this._cumulative},BaseChart.prototype.xAxisFormat=function(a){return arguments.length?(this.xFormatFunc=a,this):this.xFormatFunc},BaseChart.prototype.updateMax=function(a){var b,c=0;if(this._series.length)for(var d in this._series)b=this.cumulative()?this._series[d].cumulative:this._series[d].calculation,c+=b(a),this._currentMax=c>this._currentMax?c:this._currentMax;else c=this._valueAccessor(a),this._currentMax=c>this._currentMax?c:this._currentMax;if(this._ranges.length)for(var e in this._ranges)b=this._ranges[e].calculation,c=b(a),this._currentMax=c>this._currentMax?c:this._currentMax;return this._currentMax},BaseChart.prototype.targetMax=function(a){var b=0;return this._targets&&(func=this.cumulative()?this._targets.cumulative:this._targets.calculation,b=func(a),this._currentMax=b>this._currentMax?b:this._currentMax),this._currentMax},BaseChart.prototype.findMax=function(){var a=this,b=d3.max(this.dataset(),function(b){return a.updateMax(b)});if(this._targets){var c=d3.max(this._targets.data.getData(),function(b){return a.targetMax(b)});b=b>c?b:c}return this.maxUpdatedEvent(b),b},BaseChart.prototype.zeroValueEntry=function(a){var b,c=0;if(this._series.length)for(var d in this._series)b=this.cumulative()?this._series[d].cumulative:this._series[d].calculation,c|=Math.round(b(a),1)>0;else c|=Math.round(this._valueAccessor(a),1)>0;return this._targets&&(b=this.cumulative()?this._targets.cumulative:this._targets.calculation,c|=Math.round(b(a),1)>0),c},BaseChart.prototype.keys=function(){var a=this,b=[];return b=this._redrawAxes?this.dataset().filter(function(b){return a.zeroValueEntry(b)}).map(this._keyAccessor):this.dataset().map(this._keyAccessor)},BaseChart.prototype.targets=function(a){return arguments.length?(this._targets=a,this):this._targets},BaseChart.prototype.ranges=function(a){return arguments.length?(this._ranges=a,this):this._ranges},BaseChart.prototype.toggleSortIcon=function(){var a=this;a.ordered()?d3.select(a.element).select(".fa-arrow-up").style("display","inline-block"):d3.select(a.element).select(".fa-arrow-up").style("display","none")},BaseChart.prototype.titleClicked=function(){this.ordered(!this.ordered()),this.toggleSortIcon.call(this),this.draw()},BaseChart.prototype.applyOrderableHeader=function(){if(this.orderable()){var a=this.ordered()?"inline-block":"none";d3.select(this.element).select("div.title").style("cursor","pointer").on("click",this.titleClicked.bind(this)).append("div").attr("class","order-icon fa fa-arrow-up").style("display",a)}},BaseChart.prototype.createChart=function(){return d3.select(this.element).append("div").attr("class","title").text(this._displayName),this.chart=d3.select(this.element).append("svg").attr("class","chart"),this.chart.attr("width",this.width()).attr("height",this.height()),this.chart=this.chart.append("g").attr("transform","translate("+this.margin().left+","+this.margin().top+")"),this.applyOrderableHeader(),this.tooltip(),this.chart},BaseChart.prototype.topResults=function(a){return arguments.length?(this._topResults=a,this):this._topResults},BaseChart.prototype.dataset=function(){var a=this.ordered()?this.group.getOrderedData():this.group.getData();return a.filter(this._limitFunction)},BaseChart.prototype.targetData=function(){return this._targets.data.getData().filter(this._limitFunction)},BaseChart.prototype.keyAccessor=function(a){return arguments.length?(this._keyAccessor=a,this):this._keyAccessor},BaseChart.prototype.labelAccessor=function(a){return arguments.length?(this._labelAccessor=a,this):this._labelAccessor},BaseChart.prototype.tooltipFormat=function(a){return arguments.length?(this._tooltipFormat=a,this):this._tooltipFormat},BaseChart.prototype.barPadding=function(a){return arguments.length?(this._barPadding=a,this):this._barPadding},BaseChart.prototype.yAxisFormat=function(a){return arguments.length?(this._yAxisFormat=a,this):this._yAxisFormat},BaseChart.prototype.valueAccessor=function(a){return arguments.length?(this._valueAccessor=a,this):this._valueAccessor},BaseChart.prototype.redrawAxes=function(a){return arguments.length?(this._redrawAxes=a,this):this._redrawAxes},BaseChart.prototype.margin=function(a){return arguments.length?(this._margin=a,this):this._margin},BaseChart.prototype.setXAxis=function(a){return arguments.length?(this.x=a,this):this.x},BaseChart.prototype.draw=function(){},BaseChart.prototype.init=function(){},BaseChart.prototype.invert=function(a){return arguments.length?(this._invert=a,this):this._invert},BaseChart.prototype.setHover=function(){d3.select(this).classed("active",!0)
},BaseChart.prototype.removeHover=function(){d3.select(this).classed("active",!1)},BaseChart.prototype.mouseOver=function(a,b){if(a.hasTooltip){var c=$(b).find(".tipValue").first().text(),d=$(b).find(".tipLabel").first().text();a.tip.show({label:d,value:c})}d3.select(b).classed("active",!0)},BaseChart.prototype.mouseOut=function(a,b,c){a.hasTooltip&&a.tip.hide(c),d3.select(b).classed("active",!1)},BaseChart.prototype.labelColor=function(a){return arguments.length?(this._labelColor=a,this):this._labelColor},BaseChart.prototype.barColor=function(a){return arguments.length?(this._barColor=a,this):this._barColor},BaseChart.prototype.tooltipLabel=function(a){return arguments.length?(this._tooltipLabel=a,this):this._tooltipLabel},BaseChart.prototype.tooltip=function(){return this.hasTooltip=!0,this.tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return"<span class='tiplabel'>"+a.label+": </span><span class='tipvalue'>"+a.value+"</span>"}),this.chart.call(this.tip),this},BaseChart.prototype.filterKey=function(){},BaseChart.prototype.limitFunction=function(a){return arguments.length?(this._limitFunction=a,this):this._limitFunction},BaseChart.prototype.labelPadding=function(a){return arguments.length?(this._labelPadding=a,this):this._labelPadding},BaseChart.prototype.labelFontSize=function(a){return arguments.length?(this._labelFontSize=a,this):this._labelFontSize},BaseChart.prototype.stackedSeries=function(a){return arguments.length?(this._series=a,this):this._series},BaseChart.prototype.xBounds=function(){var a=this.invert()?this.margin().right:this.margin().left,b=this.width()-(this.margin().right+this.margin().left);return{start:a,end:b}},BaseChart.prototype.yBounds=function(){var a=this.invert()?this.margin().top:this.margin().bottom,b=this.height()-(this.margin().top+this.margin().bottom);return{start:a,end:b}},BaseChart.prototype.labelAnchoring=function(){return this.invert()?"end":"start"},BaseChart.prototype.filterFunction=function(a,b){var c=a.key?a.key:a;return{name:c,element:b,filterFunction:function(a){return String(a)==String(c)}}},BaseChart.prototype.filterClick=function(a,b){var c=this.filterFunction(b,a);this.filterEvent(this.dimension,c)},BaseChart.prototype.triggerRedraw=function(){},BaseChart.prototype.filterEvent=function(){},BaseChart.prototype.maxUpdatedEvent=function(a){this._linkedCharts.forEach(function(b){b._currentMax=b._currentMax<a?a:b._currentMax})},BaseChart.prototype.updateTargets=function(){},BaseChart.prototype.drawTargets=function(){},Legend.prototype=Object.create(BaseChart.prototype),Legend.prototype.constructor=Legend,DataTable.prototype=Object.create(BaseChart.prototype),DataTable.prototype.constructor=DataTable;var BarChart=function(a,b,c,d){BaseChart.call(this,a,b,c,d);var e=this;this.xFormatFunc=function(a){return a},this.init=function(){var a=this;this.createChart(),this._currentMax=this.findMax(),this.initializeAxes(),this.yAxis=d3.svg.axis().scale(this.y).orient("left").tickSize(0).tickFormat(function(b){return a._yAxisFormat(b)}),this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickSize(0).tickFormat(function(b){return a.xFormatFunc(b)});var b=this._ranges.filter(function(a){return"behind"==a.position});b&&this.drawRanges(b);var c=this.chart.selectAll("rect.bar").data(this.dataset()).enter().append("rect").attr("class","bar").attr("x",this.xPosition).attr("y",this.yPosition).attr("width",this.barWidth).attr("height",this.barHeight).attr("fill",this._barColor).on("mouseover",function(){a.mouseOver(a,this)}).on("mouseout",function(){a.mouseOut(a,this)});c.append("svg:text").text(this.tooltipText).attr("class","tipValue"),c.append("svg:text").text(this._tooltipLabel).attr("class","tipLabel");var d=this._ranges.filter(function(a){return"front"==a.position});d&&this.drawRanges(d),this._targets&&this.drawTargets(),this.drawAxes()},this.drawAxes=function(){var a=this;this.chart.append("g").attr("class","y-axis").call(this.yAxis).selectAll("text").attr("class","axis-text"),this.chart.append("g").attr("transform","translate(0,"+(a.height()-a.margin().bottom-a.margin().top)+")").attr("class","x-axis").call(this.xAxis).selectAll("text").style("text-anchor","start").attr("transform","rotate(90)").attr("dx","10").attr("dy","0").attr("class","axis-text").on("mouseover",this.setHover).on("mouseout",this.removeHover).on("click",function(b){return a.filterClick(this,b)})},this.draw=function(){this.x.domain(this.keys()).rangeRoundBands([0,this.xDomain()],this.barPadding());this.keys();e._redrawAxes&&this.y.domain([0,e.findMax()]).range([this.height()-this.margin().top-this.margin().bottom,0]);e.chart.selectAll("rect").data(this.dataset()).transition().duration(this.animationDuration).attr("x",this.xPosition).attr("y",this.yPosition).attr("width",this.barWidth).attr("height",this.barHeight),this.chart.selectAll("text.tipValue").data(this.dataset()).text(this.tooltipText);this._targets&&this.updateTargets(),this._ranges&&this.updateRanges(),this.chart.selectAll("g.y-axis").call(this.yAxis).selectAll("text").attr("class","axis-text");var a=this.chart.selectAll("g.x-axis").call(this.xAxis);a.selectAll("text").style("text-anchor","start").attr("transform","rotate(90)").attr("dx","10").attr("dy","0").on("mouseover",this.setHover).on("mouseout",this.removeHover).on("click",function(a){return e.filterClick(this,a)}),a.selectAll("text:not(.selected)").attr("class","axis-text")},this.drawTargets=function(){if(this._targets){this._targetAccessor=this._targets.calculation;var a=this.chart.selectAll("rect.target").data(this.targetData()).enter().append("rect").attr("class","target "+this._targets.name+"class").attr("x",this.targetX).attr("y",this.targetY).attr("width",this.targetWidth).attr("height",4).attr("fill",this._targets.color).on("mouseover",function(){e.mouseOver(e,this)}).on("mouseout",function(){e.mouseOut(e,this)});a.append("svg:text").text(this.targetTooltipText).attr("class","tipValue"),a.append("svg:text").text(this._targets.label).attr("class","tipLabel")}},this.drawRanges=function(a){if(a)for(var b in a){this._rangeAccessor=a[b].calculation;var c=a[b].type(this);this.chart.append("svg:path").datum(this.dataset()).attr("d",c).attr("fill",a[b].color).attr("class",a[b].class)}},this.updateRanges=function(){if(this._ranges)for(var a in this._ranges){this._rangeAccessor=this._ranges[a].calculation;{var b=this._ranges[a].type(this);this.dataset()}this.chart.selectAll("path."+e._ranges[a].class).datum(this.dataset()).transition().duration(this.duration).attr("d",b).attr("fill",e._ranges[a].color).attr("class",e._ranges[a].class)}},this.updateTargets=function(){if(this._targets){var a=this.chart.selectAll("rect.target").data(this.targetData()).transition().duration(this.duration).attr("y",this.targetY);a.selectAll("text.tipValue").text(this.targetTooltipText).attr("class","tipValue")}}};BarChart.prototype=Object.create(BaseChart.prototype),BarChart.prototype.constructor=BarChart;var MultipleChart=function(a,b,c,d,e){BaseChart.call(this,a,b,c,d),this._chartGroup=e;var f=this;this.x=d3.scale.linear(),this.y=d3.scale.ordinal(),this.yAxis=d3.svg.axis().scale(this.y).orient("left").tickSize(0).tickPadding(10),this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickSize(0).tickPadding(10).tickFormat(function(a){return f.xFormatFunc(a)}),this.initializeAxes=function(){this.x.domain([0,this.findMax()]).range([0,this.xBounds().end]),this.y.domain(this.keys()).rangeRoundBands([0,this.yDomain()],.2)},this.rowWidth=function(a){return this.x(this._valueAccessor(a))}.bind(this),this.yPosition=function(a){return this.y(a.key)}.bind(this),this.rowHeight=function(){return this.y.rangeBand()}.bind(this),this.barXPosition=function(a){var b=0;return this.invert()&&(b=this.xBounds().end-this.x(this._valueAccessor(a))),b}.bind(this),this.subChartName=function(a){return"sub"+f._name.replace(/ /g,"_")+a.replace(/\s/g,"")},this.createChart=function(){return this.chart=d3.select(this.element).append("div").attr("class","chart multiChart"),this.chart.append("div").attr("class","title").text(this._displayName),this.chart},this.subCharts=[],this.init=function(){this.createChart();var a=this.chart.selectAll("div.subchart").data(this.dataset());a.enter().append("div").attr("class","subchart").attr("id",function(a){return f.subChartName(f._keyAccessor(a))}),this.dataset().forEach(function(a){var b=[],c=f.dimension.Dimension.group().reduceCount().all().map(f._keyAccessor);c.forEach(function(c){var d={key:c},e=$.grep(a.values,function(a){return a.key==c}),g=e.length?f._valueAccessor(e[0]):0;d.values=g,b.push(d)});var d=new SimpleGroup(b),e="#"+f.subChartName(a.key),g=new RowChart(a.key,e,f.dimension,d,f._chartGroup).width(300).height(300).tooltipLabel(f._tooltipLabel).tooltipFormat(f._tooltipFormat).ordered(f._orderChildren).valueAccessor(function(a){return a.values}).margin({left:120,top:0,bottom:0,right:0});f.subCharts.push(g),f._chartGroup.addChart(g),g.init()})},this.draw=function(){var a=(this.chart.selectAll("div.subchart").data(this.dataset()),this.dataset());this.subCharts.forEach(function(b){var c=$.grep(a,function(a){return a.key==b.displayName()});c=c.length?b._valueAccessor(c[0]):[],b.group.getData().forEach(function(a){var b=$.grep(c,function(b){return b.key==a.key})[0];a.values=b?b.values:0})})}};MultipleChart.prototype=Object.create(BaseChart.prototype),MultipleChart.prototype.constructor=MultipleChart,GroupedBarChart.prototype=Object.create(BaseChart.prototype),GroupedBarChart.prototype.constructor=GroupedBarChart,StackedBarChart.prototype=Object.create(BaseChart.prototype),StackedBarChart.prototype.constructor=StackedBarChart,TimeLine.prototype=Object.create(BaseChart.prototype),TimeLine.prototype.constructor=TimeLine,TimelineChart.prototype=Object.create(BaseChart.prototype),TimelineChart.prototype.constructor=TimelineChart;var RowChart=function(a,b,c,d){BaseChart.call(this,a,b,c,d);var e=this;return this.x=d3.scale.linear(),this.y=d3.scale.ordinal(),this.yAxis=d3.svg.axis().scale(this.y).orient("left").tickSize(0).tickPadding(10),this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickSize(0).tickPadding(10).tickFormat(function(a){return e.xFormatFunc(a)}),this.initializeAxes=function(){this.x.domain([0,this.findMax()]).range([0,this.xBounds().end]),this.y.domain(this.keys()).rangeRoundBands([0,this.yDomain()],.2)},this.rowWidth=function(a){return this.x(this._valueAccessor(a))}.bind(this),this.yPosition=function(a){return this.y(a.key)}.bind(this),this.rowHeight=function(){return this.y.rangeBand()}.bind(this),this.barXPosition=function(a){var b=0;return this.invert()&&(b=this.xBounds().end-this.x(this._valueAccessor(a))),b}.bind(this),this.init=function(){var a=this;this.createChart(),this.initializeAxes();var b=(this.dataset(),this.chart.append("g").selectAll("rect").data(this.dataset()).enter().append("rect").attr("x",this.barXPosition).attr("y",this.yPosition).attr("width",this.rowWidth).attr("height",this.rowHeight).attr("fill",this.barColor()).on("mouseover",function(b){a.mouseOver(a,this,b)}).on("mouseout",function(b){a.mouseOut(a,this,b)}));this.chart.selectAll("rect").data(this.dataset()).exit().remove(),b.append("svg:text").text(this.tooltipText).attr("class","tipValue"),b.append("svg:text").text(this._tooltipLabel).attr("class","tipLabel"),this.chart.append("g").attr("class","y-axis").call(this.yAxis).selectAll("text").attr("class","row-chart-y").on("mouseover",this.setHover).on("mouseout",this.removeHover).on("click",function(b){a.filterClick(this,b)})},this.draw=function(){var a=this;this.y.domain(this.keys()).rangeRoundBands([0,this.height()],.2),this.chart.selectAll("g.y-axis").call(this.yAxis).selectAll("text").each(function(){d3.select(this).classed("row-chart-y","true")}).on("mouseover",this.setHover).on("mouseout",this.removeHover).on("click",function(b){a.filterClick(this,b)}),a._redrawAxes&&this.x.domain([0,this.findMax()]).range([0,this.xBounds().end]);var b=a.chart.selectAll("rect").data(this.dataset());b.transition().duration(this.animationDuration).attr("width",this.rowWidth);var c=a.chart.selectAll("text.tipValue").data(a.dataset());c.text(this.tooltipText).attr("class","tipValue"),a._redrawAxes&&b.attr("y",this.yPosition).attr("height",this.rowHeight)},this};RowChart.prototype=Object.create(BaseChart.prototype),RowChart.prototype.constructor=RowChart,PartitionChart.prototype=Object.create(BaseChart.prototype),PartitionChart.prototype.constructor=PartitionChart;