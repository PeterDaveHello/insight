/*! InsightCharts 13-06-2014 */
function DataSet(a){this._data=a,this._orderFunction=function(a,b){return b.value-a.value},this._filterFunction=null}function Group(a){this._data=a,this._cumulative=!1,this._valueAccessor=function(a){return a},this._orderFunction=function(a,b){return b.value-a.value},this._ordered=!1}function SimpleGroup(a){this._data=a,this._orderFunction=function(a,b){return b.values-a.values}}function NestedGroup(a,b){this._dimension=a,this._data=a.Dimension.bottom(1/0),this._nestFunction=b,this._nestedData=b.entries(this._data)}function Grouping(a){this.dimension=a;var b=[],c=[],d=[],e=[];return this._compute=null,this._valueAccessor=function(a){return a},this._orderFunction=function(a,b){return b.value.Count-a.value.Count},this._ordered=!1,this.sum=function(a){return arguments.length?(b=a,this):b},this.cumulative=function(a){return arguments.length?(d=a,this):d},this.count=function(a){return arguments.length?(c=a,this):c},this.average=function(a){return arguments.length?(e=a,b=this.unique(b.concat(e)),this):e},this}function Series(a,b,c,d,e,f){this.chart=b,this.data=c,this.x=d,this.y=e,this.name=a,this.color=d3.functor(f),this.animationDuration=300,d.addSeries(this),e.addSeries(this);var g="",h=null,i=function(a){return a},j=function(a){return a.key},k=function(a){return a.value},l=k,m=d3.functor("Label");return this.dataset=function(){var a=this.x.ordered()?this.data.getOrderedData():this.data.getData();return h&&(a=a.filter(h)),a},this.keys=function(){return this.dataset().map(j)},this.cssClass=function(a){return arguments.length?(g=a,this):g},this.keyAccessor=function(a){return a.key},this.matcher=this.keyAccessor,this.xFunction=function(a){return arguments.length?(j=a,this):j},this.yFunction=function(a){return arguments.length?(l=a,k=a,this.series&&1==this.series.length&&(this.series[0].accessor=a,this.series[0].tooltipValue=a),this):k},this.filterFunction=function(a){return arguments.length?(h=a,this):h},this.tooltipFunction=function(a){return arguments.length?(l=a,this):l},this.tooltipValue=function(a){return i(l(a))},this.tooltipLabel=function(a){return m(a)},this.tooltipLabelFormat=function(a){return arguments.length?(m=d3.functor(a),this):m},this.tooltipFormat=function(a){return arguments.length?(i=a,this):i},this.findMax=function(a){var b=this,c=0,d=this.data.getData(),e=a==b.x?b.xFunction():b.yFunction(),f=d3.max(d,e);return c=f>c?f:c},this.draw=function(){},this}function Chart(a,b,c){this.name=a,this.element=b,this.dimension=c;var d=d3.functor(300),e=d3.functor(300),f=!1,g=null;this.container=null,this.chart=null,this._margin={top:0,left:0,right:0,bottom:0};var h=[],i=[],j=[],k=this,l=d3.functor(.1);this.addAxis=function(a){j.push(a)},this.axes=function(){return j},this.addClipPath=function(){this.chart.append("clipPath").attr("id",this.clipPath()).append("rect").attr("x",1).attr("y",0).attr("width",this.width()-this.margin().left-this.margin().right).attr("height",this.height()-this.margin().top-this.margin().bottom)},this.init=function(a,b){this.container=a?d3.select(b).append("div"):d3.select(this.element).append("div"),this.container.attr("class",InsightConstants.ContainerClass).style("width",this.width()+"px").style("position","relative").style("display","inline-block"),this.chartSVG=this.container.append("svg").attr("class",InsightConstants.ChartSVG).attr("width",this.width()).attr("height",this.height()),this.chart=this.chartSVG.append("g").attr("class",InsightConstants.Chart).attr("transform","translate("+this.margin().left+","+this.margin().top+")"),this.addClipPath(),i.map(function(a){a.initialize()}),j.map(function(a){a.initialize()}),f&&this.initZoom(),this.tooltip(),this.draw(!1)},this.resizeChart=function(){this.container.style("width",this.width()+"px"),this.chartSVG.attr("width",this.width()).attr("height",this.height()),this.chart=this.chart.attr("transform","translate("+this.margin().left+","+this.margin().top+")"),this.chart.select("#"+this.clipPath()).append("rect").attr("x",1).attr("y",0).attr("width",this.width()-this.margin().left-this.margin().right).attr("height",this.height()-this.margin().top-this.margin().bottom)},this.draw=function(a){this.resizeChart(),this.recalculateScales(),j.map(function(b){b.draw(a)}),this.series().map(function(b){b.draw(a)})},this.recalculateScales=function(){i.map(function(a){var b=g!=a;b&&a.initialize()})},this.zoomable=function(a){return f=!0,g=a,this},this.initZoom=function(){this.zoom=d3.behavior.zoom().on("zoom",k.dragging.bind(k)),this.zoom.x(g.scale),this.zoomExists()||this.chart.append("rect").attr("class","zoompane").attr("width",this.width()).attr("height",this.height()-this.margin().top-this.margin().bottom).style("fill","none").style("pointer-events","all"),this.chart.select(".zoompane").call(this.zoom)},this.zoomExists=function(){var a=this.chart.selectAll(".zoompane");return a[0].length},this.dragging=function(){k.draw(!0)},this.barPadding=function(a){return arguments.length?(l=d3.functor(a),this):l()},this.margin=function(a){return arguments.length?(this._margin=a,this):this._margin},this.clipPath=function(){return this.name.split(" ").join("_")+"clip"},this.filterFunction=function(a,b){var c=a.key?a.key:a;return{name:c,element:b,filterFunction:function(a){return Array.isArray(a)?-1!=a.indexOf(c):String(a)==String(c)}}},this.dimensionSelector=function(a){var b=k.dimension&&a.key.replace?k.dimension.Name+a.key.replace(/[^A-Z0-9]/gi,"_"):"";return b},this.filterClick=function(a,b){if(this.dimension){var c=d3.select(a).classed("selected");d3.selectAll("."+k.dimensionSelector(b)).classed("selected",!c);var d=this.filterFunction(b,a);this.filterEvent(this.dimension,d)}},this.tooltip=function(){return this.tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){return"<span class='tiplabel'>"+a.label+": </span><span class='tipvalue'>"+a.value+"</span>"}),this.chart.call(this.tip),this},this.mouseOver=function(a,b){var c=$(b).find(".tipValue").first().text(),d=$(b).find(".tipLabel").first().text();this.tip.show({label:d,value:c}),d3.select(b).classed("active",!0)},this.mouseOut=function(a,b,c){this.tip.hide(c),d3.select(b).classed("active",!1)},this.width=function(a){return arguments.length?(e=d3.functor(a),this):e()},this.height=function(a){return arguments.length?(d=d3.functor(a),this):d()},this.series=function(a){return arguments.length?void(h=a):h},this.scales=function(a){return arguments.length?void(i=a):i},this.addHorizontalScale=function(a,b,c){new Scale(this,a,c,b)},this.addHorizontalAxis=function(a){new Axis(this,a,"h","left")}}function BubbleSeries(a,b,c,d,e,f){Series.call(this,a,b,c,d,e,f);var g=d3.functor(10),h=d3.functor(f),i=d3.functor(50),j=d3.functor(7),k=this,l=function(a){k.chart.mouseOver(k,this,a),d3.select(this).classed("hover",!0)},m=function(a){k.chart.mouseOut(k,this,a)};this.rangeY=function(a){k.yFunction();return k.y.scale(k.yFunction()(a))},this.rangeX=function(a){k.xFunction();return k.x.scale(k.xFunction()(a))},this.radiusFunction=function(a){return arguments.length?(g=a,this):g},this.fillFunction=function(a){return arguments.length?(h=a,this):h},this.selector=this.name+InsightConstants.Bubble,this.className=function(a){return k.selector+" "+InsightConstants.Bubble+" "+k.chart.dimensionSelector(a)},this.draw=function(a){var b=a?0:function(a,b){return 200+20*b},c=this.dataset(),d=d3.min(c,g),e=d3.max(c,g),f=function(a){return a.radius},n=function(a){return k.chart.filterClick(this,a)};c.forEach(function(a){var b=g(a);a.radius=j()+(b-d)*(i()-j())/(e-d)}),c=c.concat().sort(function(a,b){return d3.descending(f(a),f(b))});var o=this.chart.chart.selectAll("circle."+k.selector).data(c,k.matcher);o.enter().append("circle").attr("class",k.className).on("mouseover",l).on("mouseout",m).on("click",n),o.transition().duration(b).attr("r",f).attr("cx",k.rangeX).attr("cy",k.rangeY).attr("fill",h),o.append("svg:text").attr("class",InsightConstants.ToolTipTextClass),o.append("svg:text").attr("class",InsightConstants.ToolTipLabelClass),o.selectAll("."+InsightConstants.ToolTipTextClass).text(this.tooltipValue),o.selectAll("."+InsightConstants.ToolTipLabelClass).text(this.tooltipLabel)}}function Scale(a,b,c,d,e){var f=d3.functor(!1),g=this;this.scale=c,this.rangeType=this.scale.rangeRoundBands?this.scale.rangeRoundBands:this.scale.rangeRound,this.series=[],this.title=b,this.chart=a,this.type=e,this.direction=d,this.bounds=[],a.scales().push(this),this.domain=function(){return"linear"==this.type?[0,this.findMax()]:"ordinal"==this.type?this.findOrdinalValues():"time"==this.type?[this.minTime(),this.maxTime()]:void 0},this.calculateBounds=function(){var a=[];return g.horizontal()?(a[0]=0,a[1]=g.chart.width()-g.chart.margin().right-g.chart.margin().left):g.vertical()&&(a[1]=0,a[0]=g.chart.height()-g.chart.margin().top-g.chart.margin().bottom),a},this.minTime=function(){var a=new Date(864e13);return this.series.map(function(b){var c=d3.min(b.keys());a=a>c?c:a}),a},this.maxTime=function(){var a=new Date(-864e13);return this.series.map(function(b){var c=d3.max(b.keys());a=c>a?c:a}),a},this.findOrdinalValues=function(){var a=[];return this.series.map(function(b){a=b.keys()}),a},this.horizontal=function(){return"h"==this.direction},this.vertical=function(){return"v"==this.direction},this.findMax=function(){var a=0;return this.series.map(function(b){var c=b.findMax(g);a=c>a?c:a}),a},this.addSeries=function(a){this.series.push(a)},this.initialize=function(){this.applyScaleRange.call(this.scale.domain(this.domain()),this.rangeType)},this.calculateRange=function(){this.scale.domain(this.domain())},this.applyScaleRange=function(a){var b=g.calculateBounds();g.bounds=b,a.apply(this,[b,g.chart.barPadding()])},this.ordered=function(a){return arguments.length?(f=d3.functor(a),this):f()}}function Axis(a,b,c,d){this.chart=a,this.scale=c,this.anchor=d?d:"left",this.name=b;var e,f=this,g=d3.functor(0),h=d3.functor(10),i=d3.functor("lr"),j=d3.functor(c.horizontal()?this.anchor:this.anchor);c.vertical()&&(e="left"==this.anchor?"end":"start"),c.horizontal()&&(e="start");var k=function(a){return a};this.chart.addAxis(this),this.format=function(a){return arguments.length?(k=a,this):k},this.orientation=function(a){return arguments.length?(j=d3.functor(a),this):j()},this.tickSize=function(a){return arguments.length?(g=d3.functor(a),this):g()},this.tickPadding=function(a){return arguments.length?(h=d3.functor(a),this):h()},this.textAnchor=function(a){return arguments.length?(e=a,this):e},this.labelOrientation=function(a){return arguments.length?(i=d3.functor(a),this):i()},this.tickRotation=function(){var a=f.tickPadding()+2*f.tickSize(),b="tb"==this.labelOrientation()?"rotate(90,0,"+a+")":"";return b},this.transform=function(){var a="translate(";if(f.scale.horizontal())a+="0,"+(f.chart.height()-f.chart.margin().bottom-f.chart.margin().top)+")";else if(f.scale.vertical()){var b="left"==f.anchor?0:f.chart.width()-f.chart.margin().right-f.chart.margin().left;a+=b+",0)"}return a},this.labelHorizontalPosition=function(){var a="";return f.scale.horizontal()||f.scale.vertical(),a},this.labelVerticalPosition=function(){var a="";return f.scale.horizontal()||f.scale.vertical(),a},this.positionLabels=function(a){f.scale.horizontal()?a.style("left",0).style("bottom",0).style("width","100%").style("text-align","center"):f.scale.vertical()&&a.style("left","0").style("top","35%")},this.initialize=function(){this.axis=d3.svg.axis().scale(this.scale.scale).orient(f.orientation()).tickSize(f.tickSize()).tickPadding(f.tickPadding()).tickFormat(f.format()),this.chart.chart.append("g").attr("class",f.name+" "+InsightConstants.AxisClass).attr("transform",f.transform()).call(this.axis).selectAll("text").attr("class",f.name+" "+InsightConstants.AxisTextClass).style("text-anchor",f.textAnchor()).style("transform",f.tickRotation());var a=this.chart.container.append("div").attr("class",f.name+InsightConstants.AxisLabelClass).style("position","absolute").text(f.scale.title);this.positionLabels(a)},this.draw=function(){this.axis=d3.svg.axis().scale(this.scale.scale).orient(f.orientation()).tickSize(f.tickSize()).tickPadding(f.tickPadding()).tickFormat(f.format());var a=this.chart.chart.selectAll("g."+f.name+"."+InsightConstants.AxisClass).transition().duration(500).attr("transform",f.transform()).call(this.axis);a.selectAll("text").attr("transform",f.tickRotation()).style("text-anchor",f.textAnchor()),d3.select(this.chart.element).select("div."+f.name+InsightConstants.AxisLabelClass).text(f.scale.title)}}function LineSeries(a,b,c,d,e,f){Series.call(this,a,b,c,d,e,f);var g=this,h="linear",i=function(a){g.chart.mouseOver(g,this,a),d3.select(this).classed("hover",!0)},j=function(a){g.chart.mouseOut(g,this,a)},k=function(){},l=function(){},m=function(){};this.rangeY=function(a){return g.y.scale(g.yFunction()(a))},this.rangeX=function(a){var b=0;return b=g.x.scale.rangeBand?g.x.scale(g.xFunction()(a))+g.x.scale.rangeBand()/2:g.x.scale(g.xFunction()(a))},this.lineType=function(a){return arguments.length?(h=a,this):h},this.draw=function(a){var b=d3.svg.line().x(g.rangeX).y(g.rangeY).interpolate(h),c="path."+this.name+".in-line",d=this.chart.chart.selectAll(c);this.rangeExists(d)||this.chart.chart.append("path").attr("class",this.name+" in-line").attr("stroke",this.color).attr("fill","none").attr("clip-path","url(#"+this.chart.clipPath()+")").on("mouseover",k).on("mouseout",l).on("click",m);var e=a?0:function(a,b){return 300+20*b};this.chart.chart.selectAll(c).datum(this.dataset(),this.matcher).transition().duration(e).attr("d",b);var f=this.chart.chart.selectAll("circle").data(this.dataset());f.enter().append("circle").attr("class","target-point").attr("clip-path","url(#"+this.chart.clipPath()+")").attr("cx",g.rangeX).attr("cy",g.chart.height()-g.chart.margin().bottom-g.chart.margin().top).on("mouseover",i).on("mouseout",j),f.transition().duration(e).attr("cx",g.rangeX).attr("cy",g.rangeY).attr("r",2.5),f.append("svg:text").attr("class",InsightConstants.ToolTipTextClass),f.append("svg:text").attr("class",InsightConstants.ToolTipLabelClass),f.selectAll("."+InsightConstants.ToolTipTextClass).text(this.tooltipValue),f.selectAll("."+InsightConstants.ToolTipLabelClass).text(this.tooltipLabel)},this.rangeExists=function(a){return a[0].length}}function ColumnSeries(a,b,c,d,e,f){Series.call(this,a,b,c,d,e,f);var g=this,h=d3.functor(!1),i="",j=(this.x.rangeType,function(a){g.chart.mouseOver(g,this,a)}),k=function(a){g.chart.mouseOut(g,this,a)};return this.series=[{name:"default",accessor:function(a){return a.value.Count},tooltipValue:function(a){return a.value.Count},color:d3.functor("silver"),label:"Value"}],this.seriesMax=function(a){var b=0,c=0,d=g.stacked();for(var e in g.series){var f=g.series[e],h=f.accessor(a);c=d?c+h:h,b=c>b?c:b}return b},this.findMax=function(){var a=d3.max(this.data.getData(),this.seriesMax);return a},this.stacked=function(a){return arguments.length?(h=d3.functor(a),this):h()},this.calculateYPos=function(a,b){return b.yPos||(b.yPos=0),b.yPos+=a(b),b.yPos},this.xPosition=function(a){return g.x.scale(g.xFunction()(a))},this.calculateXPos=function(a,b){return b.xPos?b.xPos+=a:b.xPos=g.xPosition(b),b.xPos},this.yPosition=function(a){var b=g.y.scale(g.stackedBars()?g.calculateYPos(g.yFunction(),a):g.yFunction()(a));return b},this.barWidth=function(a){return g.x.scale.rangeBand(a)},this.groupedBarWidth=function(a){var b=g.barWidth(a),c=g.stackedBars()||1==g.series.length?b:b/g.series.length;return c},this.offsetXPosition=function(a){var b=g.groupedBarWidth(a),c=g.stackedBars()?g.xPosition(a):g.calculateXPos(b,a);return c},this.barHeight=function(a){return g.chart.height()-g.chart.margin().top-g.chart.margin().bottom-g.y.scale(g.yFunction()(a))},this.stackedBars=function(){return g.stacked()},this.className=function(a){return i+"class bar "+g.chart.dimensionSelector(a)},this.draw=function(){var a=function(a){a.yPos=0,a.xPos=0},b=this.chart.chart.selectAll("g."+InsightConstants.BarGroupClass).data(this.dataset(),this.matcher).each(a),c=b.enter().append("g").attr("class",InsightConstants.BarGroupClass),d=c.selectAll("rect.bar"),e=function(a){return g.chart.filterClick(this,a)},f=function(a,b){return 200+20*b};for(var h in this.series){var l=this.series[h];i=l.name,this.yFunction(l.accessor),d=c.append("rect").attr("class",g.className).attr("y",this.y.bounds[0]).attr("height",0).attr("fill",l.color).attr("clip-path","url(#"+this.chart.clipPath()+")").on("mouseover",j).on("mouseout",k).on("click",e),d.append("svg:text").attr("class",InsightConstants.ToolTipTextClass),d.append("svg:text").attr("class",InsightConstants.ToolTipLabelClass);var m=b.selectAll("."+i+"class.bar").transition().duration(f).attr("y",this.yPosition).attr("x",this.offsetXPosition).attr("width",this.groupedBarWidth).attr("height",this.barHeight);m.selectAll("."+InsightConstants.ToolTipTextClass).text(g.tooltipFormat()(l.tooltipValue)),m.selectAll("."+InsightConstants.ToolTipLabelClass).text(l.label)}},this}DataSet.prototype.initialize=function(){},DataSet.prototype.filterFunction=function(a){return arguments.length?(this._filterFunction=a,this):this._filterFunction},DataSet.prototype.getData=function(){var a;return a=this._data.all?this._data.all():this._data,this._filterFunction&&(a=a.filter(this._filterFunction)),a},DataSet.prototype.orderFunction=function(a){return arguments.length?(this._orderFunction=a,this):this._orderFunction},DataSet.prototype.filterFunction=function(a){return arguments.length?(this._filterFunction=a,this):this._filterFunction},DataSet.prototype.getOrderedData=function(){var a;return a=this._data.sort(this._orderFunction),this._filterFunction&&(a=a.filter(this._filterFunction)),a};var Dimension=function(a,b,c,d,e){this.Dimension=c,this.Name=a,this.Filters=[],this.Function=b,this.multiple=e,this.displayFunction=d?d:function(a){return a},this.comparer=function(a){return a.Name==this.Name}.bind(this)};Group.prototype.filterFunction=function(a){return arguments.length?(this._filterFunction=a,this):this._filterFunction},Group.prototype.cumulative=function(a){return arguments.length?(this._cumulative=a,this):this._cumulative},Group.prototype.getData=function(){var a;return a=this._data.all?this._data.all():this._data,this._filterFunction&&(a=a.filter(this._filterFunction)),a},Group.prototype.getOrderedData=function(){var a;return a=this._data.all?a=this._data.top(1/0).sort(this.orderFunction()):this._data.sort(this.orderFunction()),this._filterFunction&&(a=a.filter(this._filterFunction)),a},Group.prototype.computeFunction=function(a){return this._ordered=!0,arguments.length?(this._compute=a,this):this._compute},Group.prototype.orderFunction=function(a){return arguments.length?(this._orderFunction=a,this):this._orderFunction},Group.prototype.compute=function(){this._compute()},Group.prototype.valueAccessor=function(a){return arguments.length?(this._valueAccessor=a,this):this._valueAccessor},Group.prototype.calculateTotals=function(){if(this._cumulative){var a={},b=0,c=this,d=this._ordered?this.getOrderedData():this.getData();d.forEach(function(d){var e=c._valueAccessor(d);if("object"!=typeof e)b+=e,d.Cumulative=b;else for(var f in e){var g=f+"Cumulative";a[g]?(a[g]+=e[f],e[g]=a[g]):(a[g]=e[f],e[g]=a[g])}})}return this},SimpleGroup.prototype=Object.create(Group.prototype),SimpleGroup.prototype.constructor=SimpleGroup,SimpleGroup.prototype.getOrderedData=function(){return this._data.sort(this._orderFunction)},SimpleGroup.prototype.getData=function(){return this._data},NestedGroup.prototype=Object.create(Group.prototype),NestedGroup.prototype.constructor=NestedGroup,NestedGroup.prototype.getData=function(){return this._nestedData},NestedGroup.prototype.updateNestedData=function(){this._data=this._dimension.Dimension.bottom(1/0),this._nestedData=this._nestFunction.entries(this._data)},NestedGroup.prototype.getOrderedData=function(){return this._nestedData},Grouping.prototype.ordered=function(a){return arguments.length?(this._ordered=a,this):this._ordered},Grouping.prototype.filter=function(a){return arguments.length?(this._filterFunction=a,this):this._filterFunction},Grouping.prototype.unique=function(a){for(var b=a.concat(),c=0;c<b.length;++c)for(var d=c+1;d<b.length;++d)b[c]===b[d]&&b.splice(d--,1);return b},Grouping.prototype.initialize=function(){function a(a,b){for(var c in e){var d=e[c];if(b.hasOwnProperty(d))for(var f in b[d])if("undefined"!=typeof i[b[d][f]]){var g=i[b[d][f]];a.values[g].value++}else i[b[d][f]]=h,a.values[h]={key:b[d][f],value:1},h++}return a}function b(a,b){for(var c in e){var d=e[c];if(b.hasOwnProperty(d))for(var f in b[d]){var g=b[d][f],h=i[g];a.values[h].value--}}return a}function c(){return{values:[]}}var d=this.sum(),e=this.count(),f=this.average(),g=[],h=0,i={};return this.dimension.multiple?(g=this.dimension.Dimension.groupAll().reduce(a,b,c),this.orderFunction(function(a,b){return b.value-a.value})):g=this.dimension.Dimension.group().reduce(function(a,b){a.Count++;for(var c in d)b.hasOwnProperty(d[c])&&(a[d[c]].Sum+=b[d[c]]);for(var g in f)b.hasOwnProperty(f[g])&&(a[f[g]].Average=a[f[g]].Average+(b[f[g]]-a[f[g]].Average)/a.Count);for(var h in e)if(b.hasOwnProperty(e[h])){var i=e[h],j=b[e[h]];if(InsightUtils.isArray(j))for(var k in j){var l=j[k];a[i][l]=a[i].hasOwnProperty(l)?a[i][l]+1:1,a[i].Total++}else a[i][j]=a[i].hasOwnProperty(j)?a[i][j]+1:1,a[i].Total++}return a},function(a,b){a.Count--;for(var c in d)b.hasOwnProperty(d[c])&&(a[d[c]].Sum-=b[d[c]]);for(var g in e)if(b.hasOwnProperty(e[g])){var h=e[g],i=b[e[g]];if(InsightUtils.isArray(i))for(var j in i){var k=i[j];a[h][k]=a[h].hasOwnProperty(k)?a[h][k]-1:1,a[h].Total--}else a[h][i]=a[h].hasOwnProperty(i)?a[h][i]-1:1,a[h].Total--}for(var l in f)if(b.hasOwnProperty(f[l])){var m=(b[f[l]],a[f[l]].Sum);a[f[l]].Average=m/a.Count;var n=a[f[l]].Average;isFinite(n)||(a[f[l]].Average=0)}return a},function(){var a={Count:0};for(var b in d)a[d[b]]=a[d[b]]?a[d[b]]:{},a[d[b]].Sum=0;for(var c in f)a[f[c]]=a[f[c]]?a[f[c]]:{},a[f[c]].Average=0;for(var g in e)a[e[g]]=a[e[g]]?a[e[g]]:{},a[e[g]].Total=0;return a}),this._data=g,this.cumulative().length&&this.calculateTotals(),this},Grouping.prototype.recalculate=function(){this.cumulative().length&&this.calculateTotals(),this._compute&&this._compute()},Grouping.prototype.getData=function(){var a;return a=this.dimension.multiple?this._data.value().values:this._data.all(),this._filterFunction&&(a=a.filter(this._filterFunction)),a},Grouping.prototype.getOrderedData=function(){var a=[];return this.dimension.multiple?(a=this._data.value(),a=a.values.sort(this.orderFunction())):a=this._data.top(1/0).sort(this.orderFunction()),this._filterFunction&&(a=a.filter(this._filterFunction)),a},Grouping.prototype.computeFunction=function(a){return this._ordered=!0,arguments.length?(this._compute=a.bind(this),this):this._compute},Grouping.prototype.orderFunction=function(a){return arguments.length?(this._orderFunction=a,this):this._orderFunction},Grouping.prototype.compute=function(){this._compute()},Grouping.prototype.valueAccessor=function(a){return arguments.length?(this._valueAccessor=a,this):this._valueAccessor},Grouping.prototype.getDescendant=function(a,b){for(var c=b.split("."),d=b,e=null;c.length;)d=c.shift(),e=a,a=a[d];return{container:e,value:a,propertyName:d}},Grouping.prototype.calculateTotals=function(){var a=this,b=this.cumulative();if(b.length){var c={},d=this._ordered?this.getOrderedData():this.getData();d.forEach(function(d){b.map(function(b){var e=a.getDescendant(d.value,b),f=e.propertyName+"Cumulative";c[f]=c[f]?c[f]+e.value:e.value,e.container[f]=c[f]})})}return this};var InsightFormatters=function(a){var b={};return b.moduleProperty=1,b.currencyFormatter=function(b){var c=a.format(",f");return"£"+c(b)},b.dateFormatter=function(b){var c=a.time.format("%b %Y");return c(b)},b.percentageFormatter=function(b){var c=a.format("%");return c(b)},b}(d3),InsightConstants=function(){var a={};return a.Behind="behind",a.Front="front",a.AxisTextClass="axis-text",a.AxisLabelClass="axis-label",a.YAxisClass="y-axis",a.AxisClass="in-axis",a.XAxisClass="x-axis",a.XAxisRotation="rotate(90)",a.ToolTipTextClass="tipValue",a.ToolTipLabelClass="tipLabel",a.BarGroupClass="bargroup",a.ContainerClass="incontainer",a.ChartSVG="chartSVG",a.Bubble="bubble",a}(),InsightUtils=function(){var a={};return a.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},a}(),ChartGroup=function(a){this.Name=a,this.Charts=[],this.Dimensions=[],this.FilteredDimensions=[],this.Groups=[],this.ComputedGroups=[],this.LinkedCharts=[],this.NestedGroups=[]};ChartGroup.prototype.initCharts=function(){this.Charts.forEach(function(a){a.init()})},ChartGroup.prototype.addChart=function(a){return a.filterEvent=this.chartFilterHandler.bind(this),a.triggerRedraw=this.redrawCharts.bind(this),this.Charts.push(a),a},ChartGroup.prototype.addDimension=function(a,b,c,d,e){var f=new Dimension(b,c,a.dimension(c),d,e);return this.Dimensions.push(f),f},ChartGroup.prototype.compareFilters=function(a){return function(b){return String(b.name)==String(a.name)}},ChartGroup.prototype.chartFilterHandler=function(a,b){var c=this;if(b){var d=this.Dimensions.filter(a.comparer),e=this.FilteredDimensions.filter(a.comparer);e.length||this.FilteredDimensions.push(a);var f=this.compareFilters(b);d.map(function(a){var d=a.Filters.filter(f).length;d?c.removeMatchesFromArray(a.Filters,f):a.Filters.push(b),0===a.Filters.length?(c.removeItemFromArray(c.FilteredDimensions,a),a.Dimension.filterAll()):a.Dimension.filter(function(b){var c=a.Filters.map(function(a){return a.filterFunction(b)});return c.filter(function(a){return a}).length})}),this.Groups.forEach(function(a){a.recalculate()}),this.NestedGroups.forEach(function(a){a.updateNestedData()}),this.ComputedGroups.forEach(function(a){a.compute()}),this.redrawCharts()}},ChartGroup.prototype.redrawCharts=function(){for(var a=0;a<this.Charts.length;a++)this.Charts[a].draw()},ChartGroup.prototype.aggregate=function(a,b){var c;if(b instanceof Array)c=this.multiReduceSum(a,b),this.Groups.push(c);else{var d=a.Dimension.group().reduceSum(b);c=new Group(d),this.Groups.push(c)}return c},ChartGroup.prototype.count=function(a,b){var c;if(b instanceof Array)c=this.multiReduceCount(a,b),this.Groups.push(c);else{var d=a.Dimension.group().reduceCount(b);c=new Group(d),this.Groups.push(c)}return c},ChartGroup.prototype.addSumGrouping=function(a,b){var c=a.Dimension.group().reduceSum(b),d=new Group(c);return this.Groups.push(d),d},ChartGroup.prototype.addCustomGrouping=function(a){return this.Groups.push(a),a.cumulative()&&this.CumulativeGroups.push(a),a},ChartGroup.prototype.multiReduceSum=function(a,b){var c=a.Dimension.group().reduce(function(a,c){for(var d in b)c.hasOwnProperty(b[d])&&(a[b[d]]+=c[b[d]]);return a},function(a,c){for(var d in b)c.hasOwnProperty(b[d])&&(a[b[d]]-=c[b[d]]);return a},function(){var a={};for(var c in b)a[b[c]]=0;return a}),d=new Group(c);return d},ChartGroup.prototype.multiReduceCount=function(a,b){var c=a.Dimension.group().reduce(function(a,c){for(var d in b)c.hasOwnProperty(b[d])&&(a[b[d]][c[b[d]]]=a[b[d]].hasOwnProperty(c[b[d]])?a[b[d]][c[b[d]]]+1:1,a[b[d]].Total++);return a},function(a,c){for(var d in b)c.hasOwnProperty(b[d])&&(a[b[d]][c[b[d]]]=a[b[d]].hasOwnProperty(c[b[d]])?a[b[d]][c[b[d]]]-1:1,a[b[d]].Total--);return a},function(){var a={};for(var c in b)a[b[c]]={Total:0};return a}),d=new Group(c);return this.Groups.push(d),d},ChartGroup.prototype.removeMatchesFromArray=function(a,b){var c=this,d=a.filter(b);d.forEach(function(b){c.removeItemFromArray(a,b)})},ChartGroup.prototype.removeItemFromArray=function(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},BubbleSeries.prototype=Object.create(Series.prototype),BubbleSeries.prototype.constructor=BubbleSeries,LineSeries.prototype=Object.create(Series.prototype),LineSeries.prototype.constructor=LineSeries,ColumnSeries.prototype=Object.create(Series.prototype),ColumnSeries.prototype.constructor=ColumnSeries;