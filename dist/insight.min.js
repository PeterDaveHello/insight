!function(){var a=function(a,b){return void 0===a[b]},b=function(b,c){return!a(b,c)},c=[];if(a(window,"d3")&&c.push("d3.js"),a(window,"crossfilter")&&b(window,"console")&&b(console,"warn")&&console.warn("Crossfilter is not available so you will only have basic charting functionality. See https://github.com/ScottLogic/insight for how to get started."),c.length>0){c.unshift("Insight depends on d3 and d3.tip but the following are not defined:");var d=c.join("\n	- ")+"\nYou must include script tags for the missing dependencies. See https://github.com/ScottLogic/insight for how to get started.";throw new Error(d)}}();var insight=function(){return{Charts:[],Tables:[],Groups:[],Dimensions:[],FilteredDimensions:[],DimensionListenerMap:{},init:function(){this.Charts=[],this.Groups=[],this.FilteredDimensions=[],this.DimensionListenerMap={}},redraw:function(){this.Charts.forEach(function(a){a.draw()}),this.Tables.forEach(function(a){a.draw()})},addTable:function(a){return a.clickEvent=a.data.filterHandler,this.Tables.push(a),a},addChart:function(a){return this.Charts.push(a),a},filterFunction:function(a){var b=a.key?a.key:a;return{name:b,filterFunction:function(a){return Array.isArray(a)?-1!=a.indexOf(b):String(a)==String(b)}}},compareFilters:function(a){return function(b){return String(b.name)==String(a.name)}},applyCSSClasses:function(a,b,c){var d=this.DimensionListenerMap[a.data.dimension.Name];d.forEach(function(a){a.highlight(c,b)})},addDimensionListener:function(a,b){var c=a.dimension;if(c){var d=this.DimensionListenerMap[c.Name];d&&-1==d.indexOf(b)?d.push(b):this.DimensionListenerMap[c.Name]=[b]}},drawCharts:function(){var a=this;this.Charts.forEach(function(b){b.series().forEach(function(c){a.addDimensionListener(c.data,b)}),b.init()}),this.Tables.forEach(function(b){a.addDimensionListener(b.data,b),b.draw()})},chartFilterHandler:function(a,b,c){var d=this;this.applyCSSClasses(a,b,c);var e=a.data.dimension,f=this.filterFunction(b);if(f){var g=this.Dimensions.filter(e.comparer),h=this.FilteredDimensions.filter(e.comparer);h.length||this.FilteredDimensions.push(e);var i=this.compareFilters(f);g.map(function(a){var b=a.Filters.filter(i).length;b?insight.Utils.removeMatchesFromArray(a.Filters,i):a.Filters.push(f),0===a.Filters.length?(insight.Utils.removeItemFromArray(d.FilteredDimensions,a),a.Dimension.filterAll()):a.Dimension.filter(function(b){var c=a.Filters.map(function(a){return a.filterFunction(b)});return c.filter(function(a){return a}).length>0})}),this.Groups.forEach(function(a){a.recalculate()}),this.redraw()}}}}();insight.Constants=function(){var a={};return a.Behind="behind",a.Front="front",a.AxisTextClass="axis-text",a.AxisLabelClass="axis-label",a.YAxisClass="y-axis",a.AxisClass="in-axis",a.XAxisClass="x-axis",a.XAxisRotation="rotate(90)",a.Tooltip="d3-tip",a.ToolTipTextClass="tooltip",a.BarGroupClass="bargroup",a.BarClass="bar",a.LineClass="in-line",a.ContainerClass="incontainer",a.ChartSVG="chartSVG",a.PlotArea="plotArea",a.Legend="legend",a.LegendView="legend-view",a.Bubble="bubble",a.Scatter="scatter",a.TableClass="in-table",a.TableRowClass="in-datarow",a}(),insight.Scales=function(){var a={};return a.Ordinal={name:"ordinal",scale:d3.scale.ordinal},a.Linear={name:"linear",scale:d3.scale.linear},a.Time={name:"time",scale:d3.time.scale},a}(),insight.Formatters=function(a){var b={};return b.moduleProperty=1,b.currencyFormatter=function(b){var c=a.format("0,000");return"£"+c(b)},b.decimalCurrencyFormatter=function(b){var c=a.format("0.2f");return"£"+c(b)},b.numberFormatter=function(b){var c=a.format("0,000.0f");return c(b)},b.dateFormatter=function(b){var c=a.time.format("%b %Y");return c(b)},b.percentageFormatter=function(b){var c=a.format("%");return c(b)},b.format=function(b,c){var d=a.format(b);return d(c)},b}(d3),insight.Utils=function(){var a={},b=function(a,c,d){if(0===d.length)return 0;var e=d[0],f=e.sortParameter,g=e.order,h=f(a),i=f(c);if(h==i)return b(a,c,d.slice(1));var j=h>i?1:-1;return"ASC"==g?j:-j};return a.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},a.isDate=function(a){return a instanceof Date},a.isNumber=function(a){return"[object Number]"===Object.prototype.toString.call(a)},a.keySelector=function(a){var b=a.key.toString(),c="in_"+b.replace(/[^A-Z0-9]/gi,"_");return c},a.removeMatchesFromArray=function(a,b){var c=this,d=a.filter(b);d.forEach(function(b){c.removeItemFromArray(a,b)})},a.removeItemFromArray=function(a,b){var c=a.indexOf(b);c>-1&&a.splice(c,1)},a.arrayUnique=function(a){for(var b=a.concat(),c=0;c<b.length;++c)for(var d=c+1;d<b.length;++d)b[c]===b[d]&&b.splice(d--,1);return b},a.objectUnion=function(a,b){var c={},d=null;for(d in b)c[d]=b[d];for(d in a)c[d]=a[d];return c},a.multiSort=function(a,c){if(!c.length)return a;var d=function(a,d){var e=b(a,d,c,0);return e};return a.sort(d)},a.getSVGBoundingBox=function(a){var b=a.ownerSVGElement.createSVGPoint(),c={},d=a.getCTM(),e=a.getBBox(),f=e.width,g=e.height,h=e.x,i=e.y;return b.x=h,b.y=i,c.nw=b.matrixTransform(d),b.x+=f,c.ne=b.matrixTransform(d),b.y+=g,c.se=b.matrixTransform(d),b.x-=f,c.sw=b.matrixTransform(d),b.y-=g/2,c.w=b.matrixTransform(d),b.x+=f,c.e=b.matrixTransform(d),b.x-=f/2,b.y-=g/2,c.n=b.matrixTransform(d),b.y+=g,c.s=b.matrixTransform(d),c},a.safeString=function(a){return a.split(" ").join("_")},a.valueForKey=function(a,b,c,d){var e=a.filter(function(a){return c(a)==b});return d(e[0])},a}(),insight.DataSet=function(a){function b(a){this._data=a,this.Dimensions=[],this.Groups=[],this.ndx=null,this._orderFunction=function(a,b){return b.value-a.value},this._filterFunction=null}return b.prototype.initialize=function(){},b.prototype.filterFunction=function(a){return arguments.length?(this._filterFunction=a,this):this._filterFunction},b.prototype.getData=function(){var a;return a=this._data.all?this._data.all():this._data,this._filterFunction&&(a=a.filter(this._filterFunction)),a},b.prototype.orderFunction=function(a){return arguments.length?(this._orderFunction=a,this):this._orderFunction},b.prototype.filterFunction=function(a){return arguments.length?(this._filterFunction=a,this):this._filterFunction},b.prototype.getOrderedData=function(){var a;return a=this._data.sort(this._orderFunction),this._filterFunction&&(a=a.filter(this._filterFunction)),a},b.prototype.group=function(b,c,d){this.ndx=this.ndx?this.ndx:crossfilter(this._data);var e=new a.Dimension(b,c,this.ndx.dimension(c),c,d),f=new a.Grouping(e);return a.Dimensions.push(e),a.Groups.push(f),f.filterHandler=a.chartFilterHandler.bind(a),f},b}(insight),insight.Dimension=function(){var a=function(a,b,c,d,e){this.Dimension=c,this.Name=a,this.Filters=[],this.Function=b,this.multiple=e,this.displayFunction=d?d:function(a){return a},this.comparer=function(a){return a.Name==this.Name}.bind(this)};return a}(insight),insight.Grouping=function(a){function b(b){this.dimension=b;var c=[],d=[],e=[],f=[],g=!1,h=this,i=null,j=function(a,b){return b.value.Count-a.value.Count};return this.registerSeries=function(a){a.clickEvent=this.filterHandler},this.filterHandler=function(){},this.sum=function(a){return arguments.length?(c=a,this):c},this.cumulative=function(a){return arguments.length?(e=a,this):e},this.count=function(a){return arguments.length?(d=a,this):d},this.mean=function(b){return arguments.length?(f=b,c=a.Utils.arrayUnique(c.concat(f)),this):f},this.orderFunction=function(a){return arguments.length?(j=a,this):j},this.ordered=function(a){return arguments.length?(g=a,this):g},this.filter=function(a){return arguments.length?(i=a,this):i},this.reduceMultiDimension=function(){function a(a,b){for(var c in d){var g=d[c];if(b.hasOwnProperty(g))for(var h in b[g])if("undefined"!=typeof f[b[g][h]]){var i=f[b[g][h]];a.values[i].value++}else f[b[g][h]]=e,a.values[e]={key:b[g][h],value:1},e++}return a}function b(a,b){for(var c in d){var e=d[c];if(b.hasOwnProperty(e))for(var g in b[e]){var h=b[e][g],i=f[h];a.values[i].value--}}return a}function c(){return{values:[]}}var d=(h.sum(),h.count()),e=(h.mean(),0),f={};return data=h.dimension.Dimension.groupAll().reduce(a,b,c),h.orderFunction(function(a,b){return b.value-a.value}),data},this.recalculate=function(){h.postAggregationCalculations()},this.initialize=function(){var b=this.sum(),c=this.count(),d=this.mean(),e="",f=[];return f=h.dimension.multiple?h.reduceMultiDimension():h.dimension.Dimension.group().reduce(function(d,f){d.Count++;for(var g in b)f.hasOwnProperty(b[g])&&(d[b[g]].Sum+=f[b[g]]);for(var h in c)if(f.hasOwnProperty(c[h])){e=c[h];var i=f[c[h]];if(a.Utils.isArray(i))for(var j in i){var k=i[j];d[e][k]=d[e].hasOwnProperty(k)?d[e][k]+1:1,d[e].Total++}else d[e][i]=d[e].hasOwnProperty(i)?d[e][i]+1:1,d[e].Total++}return d},function(d,f){d.Count--;for(var g in b)f.hasOwnProperty(b[g])&&(d[b[g]].Sum-=f[b[g]]);for(var h in c)if(f.hasOwnProperty(c[h])){e=c[h];var i=f[c[h]];if(a.Utils.isArray(i))for(var j in i){var k=i[j];d[e][k]=d[e].hasOwnProperty(k)?d[e][k]-1:0,d[e].Total--}else d[e][i]=d[e].hasOwnProperty(i)?d[e][i]-1:0,d[e].Total--}return d},function(){var a={Count:0};for(var e in b)a[b[e]]=a[b[e]]?a[b[e]]:{},a[b[e]].Sum=0;for(var f in d)a[d[f]]=a[d[f]]?a[d[f]]:{},a[d[f]].Average=0;for(var g in c)a[c[g]]=a[c[g]]?a[c[g]]:{},a[c[g]].Total=0;return a}),h.data=f,h.recalculate(),this},this.getData=function(a,b){var c;return h.data||h.initialize(),c=this.dimension.multiple?h.data.value().values:h.data.all(),c=c.slice(0),a&&(c=c.sort(a)),b&&(c=c.slice(0,b)),i&&(c=c.filter(i)),c},this.getDescendant=function(a,b){for(var c=b.split("."),d=b,e=null;c.length;)d=c.shift(),e=a,a=a[d];return{container:e,value:a,propertyName:d}},this.calculateAverages=function(b){var c=h.mean();for(var d in c){var e=c[d],f=b.value[e],g=f.Sum/b.value.Count;g=a.Utils.isNumber(g)&isFinite(g)?g:0,b.value[e].Average=g}},this.postAggregationCalculations=function(){var a={},b=h.ordered()?h.getData(this.orderFunction()):h.getData();b.forEach(function(b){h.calculateAverages(b),h.calculateCumulativeValues(b,a)})},this.calculateCumulativeValues=function(a,b){var c=this.cumulative();return c.map(function(c){var d=h.getDescendant(a.value,c),e=d.propertyName+"Cumulative";b[e]=b[e]?b[e]+d.value:d.value,d.container[e]=b[e]}),b},this}return b}(insight),function(a){a.Chart=function(a){function b(b,c){this.name=b,this.element=c,this.selectedItems=[];var d=null,e=null;this.container=null,this.chart=null,this.measureCanvas=document.createElement("canvas"),this._margin={top:0,left:0,right:0,bottom:0},this.legendView=null;var f=d3.functor(300),g=d3.functor(300),h=!1,i=[],j=[],k=[],l=this,m="",n=!0;this.init=function(b,c){l.container=b?d3.select(c).append("div"):d3.select(l.element).append("div"),l.container.attr("class",a.Constants.ContainerClass).style("position","relative").style("display","inline-block"),l.chartSVG=l.container.append("svg").attr("class",a.Constants.ChartSVG),l.plotArea=l.chartSVG.append("g").attr("class",a.Constants.PlotArea),l.addClipPath(),l.draw(!1),h&&l.initZoom()},this.draw=function(a){this.resizeChart();var b=j.concat(k);b.map(function(b){b.draw(l,a)}),this.series().map(function(b){b.draw(l,a)}),null!==d&&d.draw(l,l.series())},this.addClipPath=function(){this.plotArea.append("clipPath").attr("id",this.clipPath()).append("rect").attr("x",1).attr("y",0).attr("width",this.width()-this.margin().left-this.margin().right).attr("height",this.height()-this.margin().top-this.margin().bottom)},this.resizeChart=function(){n&&l.calculateLabelMargin();var a=l.margin(),b=l.measureCanvas.getContext("2d");b.font="15pt Open Sans Bold",l.container.style("width",l.width()+"px"),l.chartSVG.attr("width",l.width()).attr("height",l.height()),l.plotArea=this.plotArea.attr("transform","translate("+a.left+","+a.top+")"),l.plotArea.select("#"+l.clipPath()).append("rect").attr("x",1).attr("y",0).attr("width",l.width()-a.left-a.right).attr("height",l.height()-a.top-a.bottom)},this.zoomable=function(a){return h=!0,e=a,a.zoomable(!0),this},this.initZoom=function(){this.zoom=d3.behavior.zoom().on("zoom",l.dragging.bind(l)),this.zoom.x(e.scale),this.zoomExists()||this.plotArea.insert("rect",":first-child").attr("class","zoompane").attr("width",this.width()).attr("height",this.height()-this.margin().top-this.margin().bottom).style("fill","none").style("pointer-events","all"),this.plotArea.select(".zoompane").call(this.zoom)},this.zoomExists=function(){var a=this.plotArea.selectAll(".zoompane");return a[0].length},this.dragging=function(){l.draw(!0)},this.margin=function(a){return arguments.length?(n=!1,this._margin=a,this):this._margin},this.clipPath=function(){return a.Utils.safeString(this.name)+"clip"},this.title=function(a){return arguments.length?(m=a,this):m},this.width=function(a){return arguments.length?(g=d3.functor(a),this):g()},this.height=function(a){return arguments.length?(f=d3.functor(a),this):f()},this.series=function(a){return arguments.length?(i=a,this):i},this.legend=function(a){return arguments.length?(d=a,this):d},this.addXAxis=function(a){return a.direction="h",j.push(a),this},this.xAxes=function(a){if(!arguments.length)return j;for(var b=0;b<a.length;b++)l.addXAxis(a[b]);return this},this.xAxis=function(a){if(!arguments.length)return j[0];var b=j.slice(0);return b[0]=a,this.xAxes(b)},this.addYAxis=function(a){return a.direction="v",k.push(a),this},this.yAxes=function(a){if(!arguments.length)return k;for(var b=0;b<a.length;b++)l.addYAxis(a[b]);return this},this.yAxis=function(a){if(!arguments.length)return k[0];var b=k.slice(0);return b[0]=a,this.yAxes(b)},this.addHorizontalScale=function(a,b,c){new Scale(this,a,c,b)},this.addHorizontalAxis=function(a){new Axis(this,a,"h","left")},this.autoMargin=function(a){return arguments.length?(n=a,this):n},this.highlight=function(b){var c=this.plotArea.selectAll("."+b),d=c.classed("selected");d?(c.classed("selected",!1),a.Utils.removeItemFromArray(l.selectedItems,b)):(c.classed("selected",!0).classed("notselected",!1),l.selectedItems.push(b));var e=this.plotArea.selectAll(".selected"),f=this.plotArea.selectAll(".bar:not(.selected),.bubble:not(.selected)");f.classed("notselected",e[0].length>0)},a.addChart(this)}return b.prototype.calculateLabelMargin=function(){var a=this.measureCanvas,b={top:0,left:0,bottom:0,right:0};this.series().forEach(function(c){var d=c.x,e=c.y,f=c.maxLabelDimensions(a);b[d.orientation()]=Math.max(f.maxKeyHeight,b[d.orientation()]),b[e.orientation()]=Math.max(f.maxValueWidth,b[e.orientation()])}),this.margin(b)},b}(a)}(insight),function(a){a.Table=function(){function b(b,c,d){this.name=b,this.element=c,this.data=d,this.selectedItems=[];var e,f=this,g=[],h=!1,i=[],j=null,k=function(a){return a.label},l=function(a){return a.key},m=function(a){return a.value},n=function(a){return f.columns().map(function(b){return{column:b,value:b.value(a)}})},o=function(){f.tableElement=d3.select(f.element).append("table").attr("class",a.Constants.TableClass),e=f.tableElement.append("thead").append("tr"),e.append("th").attr("class","blank").html(""),f.tableBody=f.tableElement.append("tbody"),h=!0},p=function(b){return a.Constants.TableRowClass+" "+a.Utils.keySelector(b)},q=function(b){var c=a.Utils.keySelector(b);f.clickEvent(f,b,c)},r=function(a,b){var c={sortParameter:a,order:b};i.push(c)};return this.columns=function(a){return arguments.length?(g=a,this):g},this.ascending=function(a){return r(a,"ASC"),this},this.descending=function(a){return r(a,"DESC"),this},this.top=function(a){return arguments.length?(j=a,this):j},this.dataset=function(){var b=i,c=f.data.getData();return c=a.Utils.multiSort(c,b),this.top()&&(c=c.slice(0,this.top())),c},this.highlight=function(b){var c=f.tableBody.selectAll("."+b),d=c.classed("selected");d?(c.classed("selected",!1),a.Utils.removeItemFromArray(f.selectedItems,b)):(c.classed("selected",!0).classed("notselected",!1),f.selectedItems.push(b));var e=this.tableBody.selectAll(".selected"),g=this.tableBody.selectAll("tr:not(.selected)");g.classed("notselected",e[0].length>0)},this.draw=function(){var b=this.dataset(),c=this.columns();h||o(),e.selectAll("th.column").data(c).enter().append("th").attr("class","column").html(k);var d=this.tableBody.selectAll("tr."+a.Constants.TableRowClass).data(b,l);d.enter().append("tr").attr("class",p).on("click",q).append("th").html(l);var f=d.selectAll("td").data(n);f.enter().append("td").html(m),f.exit().remove(),d.exit().remove()},this}return b.prototype.clickEvent=function(){},b}()}(insight),insight.Tooltip=function(a){function b(){function b(){var a=d3.select(g.container()).append("div");a.attr("class",f).style(g.styles()),g.element=a.node()}function c(a){d3.select(g.element).html(a)}function d(b){var c=a.Utils.getSVGBoundingBox(b),d=g.offset(),e=c.n.y-g.element.offsetHeight,f=c.n.x-g.element.offsetWidth/2;return e+=d.y,f+=d.x,{x:f,y:e}}function e(a){d3.select(g.element).style({opacity:"1",top:a.y+"px",left:a.x+"px"})}var f=a.Constants.Tooltip,g=this,h=null,i={},j={x:0,y:0},k={position:"absolute",opacity:"0",top:"0","pointer-events":"none","box-sizing":"border-box"};this.offset=function(a){return arguments.length?(j=a,this):j},this.styles=function(b){return arguments.length?(i=b,this):a.Utils.objectUnion(k,i)},this.container=function(a){return arguments.length?(h=a,this):h},this.show=function(a,f){this.element||b(),c(f);var g=d(a);e(g)},this.hide=function(){d3.select(g.element).style("opacity","0")}}return b}(insight),insight.Legend=function(){var a=!1,b=function(a,b){return 20*b+5},c=function(a){return a.color()},d=function(a,b){return 20*b+14},e=function(a){return a.name};this.init=function(b){a=!0,null!==b.legendView&&(b.legendView.removeChild(b.legendBox),b.legendView.removeChild(b.legendItems),b.chartSVG.removeChild(b.legendView)),b.legendView=b.chartSVG.append("g").attr("class",insight.Constants.LegendView).attr("transform","translate("+(b.width()-80)+",30)"),b.legendBox=b.legendView.append("rect").style("stroke","black").style("stroke-width",1).style("fill","white"),b.legendItems=b.legendView.append("g").attr("class",insight.Constants.Legend)},this.draw=function(f){a||this.init(f);var g=f.series(),h=0,i=0,j=f.measureCanvas.getContext("2d");j.font="12px sans-serif",f.legendItems.selectAll("rect").data(g).enter().append("rect").attr("x",5).attr("y",b).attr("width",10).attr("height",10).style("fill",c),f.legendItems.selectAll("text").data(g).enter().append("text").attr("x",20).attr("y",d).attr("width",function(a){return j.measureText(a.name).width}).attr("height",20).text(e).attr("font-family","sans-serif").attr("font-size","12px").attr("fill","black");for(var k=0;k<g.length;k++){var l=j.measureText(g[k].name).width;h=20*k+20,i=Math.max(i,l+25)}f.legendBox.attr("width",i).attr("height",h),f.legendItems.attr("width",i).attr("height",h)}},insight.Axis=function(a,b){this.scaleType=b.name,this.scale=b.scale(),this.rangeType=this.scale.rangeRoundBands?this.scale.rangeRoundBands:this.scale.rangeRound,this.bounds=[0,0],this.series=[],this.direction="",this.gridlines=new insight.AxisGridlines(this);var c=this,d=a,e=d3.functor(!1),f=null,g=d3.functor(1),h=d3.functor(10),i="0",j=d3.functor("lr"),k=!1,l=d3.functor("#777"),m=!0,n=d3.functor(.1),o=!1,p=!1,q=!1,r=function(){return c.horizontal()?p?"top":"bottom":p?"right":"left"},s=function(){var a=c.orientation();return"left"==a||"top"==a?"end":"start"},t=function(a){return a},u=function(a){var b=c.horizontal()?[0,c.bounds[0]]:[c.bounds[1],0];a.apply(this,[b,c.barPadding()])};this.barPadding=function(a){return arguments.length?(n=d3.functor(a),this):n()};var v=function(){var a=[];return c.series.map(function(b){a=a.concat(b.keys(c.orderingFunction()))}),a=insight.Utils.arrayUnique(a)},w=function(){var a=0;return c.series.map(function(b){var d=b.findMax(c);a=d>a?d:a}),a},x=function(){var a=new Date(864e13);return c.series.map(function(b){var c=d3.min(b.keys());a=a>c?c:a}),a},y=function(){var a=new Date(-864e13);return c.series.map(function(b){var c=d3.max(b.keys());a=c>a?c:a}),a};this.horizontal=function(){return"h"==this.direction},this.vertical=function(){return"v"==this.direction},this.ordered=function(a){return arguments.length?(e=d3.functor(a),this):e()},this.orderingFunction=function(a){return arguments.length?(f=a,this):f},this.addSeries=function(a){this.series.push(a)},this.domain=function(){var a=[];return this.scaleType==insight.Scales.Linear.name?a=[0,w()]:this.scaleType==insight.Scales.Ordinal.name?a=v():this.scaleType==insight.Scales.Time.name&&(a=[x(),y()]),a},this.calculateAxisBounds=function(a){var b=[],d=a.margin();return b[0]=a.width()-d.right-d.left,b[1]=a.height()-d.top-d.bottom,c.bounds=b,c.bounds},this.zoomable=function(a){return arguments.length?(q=a,this):q},this.display=function(a){return arguments.length?(m=a,this):m},this.reversed=function(a){return arguments.length?(p=a,this):p},this.label=function(a){return arguments.length?(d=a,this):d},this.labelFormat=function(a){return arguments.length?(t=a,this):t},this.color=function(a){return arguments.length?(l=d3.functor(a),this):l},this.orientation=function(a){return arguments.length?(r=d3.functor(a),this):r()},this.tickRotation=function(a){return arguments.length?(i=a,this):i},this.tickSize=function(a){return arguments.length?(g=d3.functor(a),this):g()},this.tickPadding=function(a){return arguments.length?(h=d3.functor(a),this):h()},this.textAnchor=function(a){return arguments.length?(s=d3.functor(a),this):s()},this.tickOrientation=function(a){return arguments.length?("tb"===a?i="90":"lr"===a&&(i="0"),j=d3.functor(a),this):j()},this.tickRotationTransform=function(){var a=c.tickPadding()+2*c.tickSize();a=p&&c.vertical()?0-a:a;var b=" rotate("+c.tickRotation()+",0,"+a+")";return b},this.axisPosition=function(){var a="translate(";if(c.horizontal()){var b=0,d="top"==c.orientation()?0:c.bounds[1];a+=b+","+d+")"}else if(c.vertical()){var e="left"==c.orientation()?0:c.bounds[0];a+=e+",0)"}return a},this.pixelValueForValue=function(a){return c.scale(a)},this.positionLabel=function(){c.horizontal()?this.labelElement.style("left",0).style(c.orientation(),0).style("width","100%").style("text-align","center"):c.vertical()&&this.labelElement.style(c.orientation(),"0").style("top","35%")},this.showGridlines=function(a){return arguments.length?(k=a,this):k},this.initializeScale=function(){u.call(this.scale.domain(this.domain()),this.rangeType)},this.setupAxisView=function(a){o||(this.initializeScale(),o=!0,this.axis=d3.svg.axis().scale(this.scale).orient(c.orientation()).tickSize(c.tickSize()).tickPadding(c.tickPadding()).tickFormat(c.labelFormat()),this.axisElement=a.plotArea.append("g"),this.axisElement.attr("class",insight.Constants.AxisClass).attr("transform",c.axisPosition()).call(this.axis).selectAll("text").attr("class",insight.Constants.AxisTextClass).style("text-anchor",c.textAnchor()).style("transform",c.tickRotationTransform()),this.labelElement=a.container.append("div").attr("class",insight.Constants.AxisLabelClass).style("position","absolute").text(this.label()))},this.draw=function(a,b){if(this.calculateAxisBounds(a),this.zoomable()||this.initializeScale(),this.display()){this.setupAxisView(a);var d=b?0:200;this.axis=d3.svg.axis().scale(this.scale).orient(c.orientation()).tickSize(c.tickSize()).tickPadding(c.tickPadding()).tickFormat(c.labelFormat()),this.axisElement.attr("transform",c.axisPosition()).style("stroke",c.color()).transition().duration(d).call(this.axis),this.axisElement.selectAll("text").attr("transform",c.tickRotationTransform()).style("text-anchor",c.textAnchor()),this.labelElement.text(this.label()),this.positionLabel(),k&&this.gridlines.drawGridLines(a,this.scale.ticks())}}},insight.AxisGridlines=function(a){this.parentAxis=a;var b="#777",c=1;this.allGridlines=function(a){var b="line."+this.parentAxis.label();return a.plotArea.selectAll(b)},this.lineColor=function(a){return arguments.length?(b=a,this):b},this.lineWidth=function(a){return arguments.length?(c=a,this):c},this.drawGridLines=function(a,d){{var e={"class":this.parentAxis.label(),fill:"none","shape-rendering":"crispEdges",stroke:b,"stroke-width":c};this.parentAxis}this.parentAxis.horizontal()?(e.x1=this.parentAxis.pixelValueForValue,e.x2=this.parentAxis.pixelValueForValue,e.y1=0,e.y2=this.parentAxis.bounds[1]):(e.x1=0,e.x2=this.parentAxis.bounds[0],e.y1=this.parentAxis.pixelValueForValue,e.y2=this.parentAxis.pixelValueForValue);var f=this.allGridlines(a).data(d);f.enter().append("line"),f.attr(e),f.exit().remove()}},insight.Series=function(a,b,c,d,e){this.data=b,this.x=c,this.y=d,this.name=a,this.color=d3.functor(e),this.animationDuration=300,this.topValues=null,this.classValues=[],this.valueAxis=c,this.keyAxis=d,this.selectedItems=[],c.addSeries(this),d.addSeries(this),b.registerSeries&&b.registerSeries(this);var f=this,g=null,h={x:0,y:-10},i=function(a){return a.key},j=function(a){return a.value},k=function(a){return a.key},l=function(a){return a},m=function(a){return j(a)},n=function(a){return l(m(a))},o=function(a,b){var c="";return a.length&&(c=-1!=a.indexOf(b)?" selected":" notselected"),c};return this.seriesClassName=function(){var a=[f.name+"class"].concat(f.classValues).join(" ");return a},this.itemClassName=function(a){var b=insight.Utils.keySelector(a),c=o(f.selectedItems,b),d=f.rootClassName+" "+b+c;return d},this.keyFunction=function(a){return arguments.length?(i=a,this):i},this.valueFunction=function(a){return arguments.length?(j=a,this):j},this.dataset=function(a){this.valueAxis.ordered()&&!a&&(a=function(a,b){return f.valueFunction()(b)-f.valueFunction()(a)});var b=this.data.getData(a,this.topValues);return g&&(b=b.filter(g)),b},this.keys=function(a){return this.dataset(a,f.topValues).map(f.keyFunction())},this.keyAccessor=function(a){return a.key},this.xFunction=function(a){return arguments.length?(k=a,this):k},this.tooltipOffset=function(a){return arguments.length?(h=a,this):h},this.initializeTooltip=function(a){this.tooltip||(this.tooltip=(new insight.Tooltip).container(a).offset(f.tooltipOffset()))},this.mouseOver=function(a,b,c){var d=c?c:f.tooltipFunction(),e=d(a);f.tooltip.show(this,e),d3.select(this).classed("active",!0)},this.mouseOut=function(){f.tooltip.hide(),d3.select(this).classed("active",!1)},this.click=function(a,b){var c=insight.Utils.keySelector(b);this.clickEvent(this,b,c)},this.filterFunction=function(a){return arguments.length?(g=a,this):g},this.tooltipFormat=function(a){return arguments.length?(l=a,this):l},this.tooltipFunction=function(a){return arguments.length?(n=a,this):n},this.top=function(a){return arguments.length?(this.topValues=a,this):this.topValues},this.maxLabelDimensions=function(a){var b=document.createElement("text");b.setAttribute("class",insight.Constants.AxisTextClass);var e=window.getComputedStyle(b),g=a.getContext("2d");g.font=e["font-size"]+" "+e["font-family"];var h=0,k=0,l=0,m=this.dataset();this.keys().forEach(function(a){var b=insight.Utils.valueForKey(m,a,i,j),c=f.x.labelFormat(),d=f.y.labelFormat(),n=c(a),o=d(b),p=g.measureText(n),q=g.measureText(o);l=Math.max(p.width,l),k=Math.max(q.width,k),h=Math.ceil(e["font-size"])||10});var n={maxKeyWidth:l,maxKeyHeight:h,maxValueWidth:k,maxValueHeight:h};if("0"!==c.tickRotation()){var o=Math.sin(c.tickRotation()*Math.PI/180),p=Math.cos(c.tickRotation()*Math.PI/180);n.maxKeyWidth=Math.ceil(Math.max(h*o,l*p)),n.maxKeyHeight=Math.ceil(Math.max(h*p,l*o))}if("0"!==d.tickRotation()){var q=Math.sin(d.tickRotation()*Math.PI/180),r=Math.cos(d.tickRotation()*Math.PI/180);n.maxValueWidth=Math.ceil(Math.max(h*q,k*r)),n.maxValueHeight=Math.ceil(Math.max(h*r,k*q))}return n},this.findMax=function(a){var b=this,c=0,d=this.dataset(),e=a==b.x?b.keyFunction():b.valueFunction(),f=d3.max(d,e);return c=f>c?f:c},this.draw=function(){},this},insight.Series.prototype.clickEvent=function(){},insight.MarkerSeries=function(a,b,c,d,e){insight.Series.call(this,a,b,c,d,e);var f=this,g=5,h=1,i=0,j=!1,k=!0;return this.xPosition=function(a){var b=0;return k?(b=f.x.scale(f.keyFunction()(a)),i||(i=f.calculateOffset(a)),b=1!=h?b+i:b):b=f.x.scale(f.valueFunction()(a)),b},this.keys=function(){var a=f.keyFunction();return f.dataset().map(a)},this.calculateOffset=function(a){var b=j?f.markerHeight(a):f.markerWidth(a),c=j?f.y.scale.rangeBand(a):f.x.scale.rangeBand(a);return.5*(c-b)},this.yPosition=function(a){var b=0;return j?(b=f.y.scale(f.keyFunction()(a)),i||(i=f.calculateOffset(a)),b=1!=h?b+i:b):b=f.y.scale(f.valueFunction()(a)),b},this.horizontal=function(){return j=!0,k=!1,this},this.vertical=function(){return k=!0,j=!1,this},this.widthFactor=function(a){return arguments.length?(h=a,this):h},this.thickness=function(a){return arguments.length?(g=a,this):g},this.markerWidth=function(a){var b=0;return b=j?f.thickness():f.x.scale.rangeBand(a)*h},this.markerHeight=function(a){var b=0;return b=j?f.y.scale.rangeBand(a)*h:f.thickness()},this.draw=function(a){f.initializeTooltip(a.container.node()),f.selectedItems=a.selectedItems,f.rootClassName=f.seriesClassName();var b=function(a){a.yPos=0,a.xPos=0},c=(this.dataset().forEach(b),a.plotArea.selectAll("g."+insight.Constants.BarGroupClass+"."+this.name).data(this.dataset(),this.keyAccessor)),d=c.enter().append("g").attr("class",insight.Constants.BarGroupClass+" "+this.name),e=d.selectAll("rect.bar"),g=function(a){return f.click(this,a)},h=function(a,b){return 200+20*b};e=d.append("rect").attr("class",f.itemClassName).attr("y",this.y.bounds[0]).attr("height",0).attr("fill",this.color).attr("clip-path","url(#"+a.clipPath()+")").on("mouseover",this.mouseOver).on("mouseout",this.mouseOut).on("click",g);var i=c.selectAll("."+this.name+"class");i.transition().duration(h).attr("y",this.yPosition).attr("x",this.xPosition).attr("width",this.markerWidth).attr("height",this.markerHeight),c.exit().remove()},this},insight.MarkerSeries.prototype=Object.create(insight.Series.prototype),insight.MarkerSeries.prototype.constructor=insight.MarkerSeries,insight.BubbleSeries=function(a,b,c,d,e){insight.Series.call(this,a,b,c,d,e);var f=this,g=(this.name+insight.Constants.Bubble,d3.functor(10));this.classValues=[insight.Constants.Bubble];var h=function(a){return a.x},i=function(a){return a.y};this.findMax=function(a){var b=this,c=0,d=this.data.getData(),e=a==b.x?b.xFunction():b.yFunction(),f=d3.max(d,e);return c=f>c?f:c},this.yFunction=function(a){return arguments.length?(i=a,this):i},this.xFunction=function(a){return arguments.length?(h=a,this):h},this.rangeY=function(a){f.yFunction();return f.y.scale(f.yFunction()(a))},this.rangeX=function(a){f.xFunction();return f.x.scale(f.xFunction()(a))},this.radiusFunction=function(a){return arguments.length?(g=a,this):g},this.bubbleData=function(a){var b=d3.max(a,g),c=function(a){return a.radius},d=(a.map(h),a.map(i),this.x.bounds[1]),e=this.y.bounds[0],f=Math.min(d/10,e/10);return a.forEach(function(a){var c=g(a);a.radius=0===c?0:c*f/b}),a=a.concat().sort(function(a,b){return d3.descending(c(a),c(b))})},this.draw=function(a,b){this.initializeTooltip(a.container.node()),this.selectedItems=a.selectedItems,this.rootClassName=f.seriesClassName();var c=b?0:function(a,b){return 200+20*b},d=function(a){return f.click(this,a)},e=this.bubbleData(this.dataset()),g=a.plotArea.selectAll("circle."+insight.Constants.Bubble).data(e,f.keyAccessor);g.enter().append("circle").attr("class",f.itemClassName).on("mouseover",f.mouseOver).on("mouseout",f.mouseOut).on("click",d);var h=function(a){return a.radius};g.transition().duration(c).attr("r",h).attr("cx",f.rangeX).attr("cy",f.rangeY).attr("opacity",.5).attr("fill",this.color)}},insight.BubbleSeries.prototype=Object.create(insight.Series.prototype),insight.BubbleSeries.prototype.constructor=insight.BubbleSeries,insight.ScatterSeries=function(a,b,c,d,e){insight.Series.call(this,a,b,c,d,e);var f=d3.functor(3),g=d3.functor(1),h=this,i=this.name+insight.Constants.Scatter,j=function(a){return a.x},k=function(a){return a.y};this.findMax=function(a){var b=this,c=0,d=this.data.getData(),e=a==b.x?b.xFunction():b.yFunction(),f=d3.max(d,e);return c=f>c?f:c},this.yFunction=function(a){return arguments.length?(k=a,this):k},this.xFunction=function(a){return arguments.length?(j=a,this):j
},this.rangeY=function(a){return h.y.scale(h.yFunction()(a))},this.rangeX=function(a){return h.x.scale(h.xFunction()(a))},this.radiusFunction=function(a){return arguments.length?(f=a,this):f},this.pointRadius=function(a){return arguments.length?(f=d3.functor(a),this):f()},this.pointOpacity=function(a){return arguments.length?(g=d3.functor(a),this):g()};var l=function(){return i+" "+insight.Constants.Scatter+" "+h.dimensionName};this.fillFunction=function(a){return arguments.length?(fillFunction=a,this):fillFunction},this.scatterData=function(a){d3.max(a,f),a.map(j),a.map(k),this.x.bounds[1],this.y.bounds[0];return a.forEach(function(a){a.radius=f(a)}),a},this.draw=function(a,b){h.initializeTooltip(a.container.node()),h.selectedItems=a.selectedItems;var c=function(a){return h.click(this,a)},d=this.scatterData(this.dataset()),e=a.plotArea.selectAll("circle."+i).data(d);e.enter().append("circle").attr("class",l).on("mouseover",this.mouseOver).on("mouseout",this.mouseOut).on("click",c),e.attr("r",f).attr("cx",h.rangeX).attr("cy",h.rangeY).attr("opacity",g).attr("fill",this.color)}},insight.ScatterSeries.prototype=Object.create(insight.Series.prototype),insight.ScatterSeries.prototype.constructor=insight.ScatterSeries,insight.RowSeries=function(a,b,c,d,e){insight.Series.call(this,a,b,c,d,e);var f=this,g=d3.functor(!1),h="",i={};this.valueAxis=d,this.keyAxis=c,this.classValues=[insight.Constants.BarClass];this.series=[{name:"default",accessor:function(a){return f.valueFunction()(a)},tooltipValue:function(a){return f.tooltipFunction()(a)},color:d3.functor(e),label:"Value"}],this.keys=function(a){return f.dataset(a,f.top()).map(f.keyFunction())},this.seriesMax=function(a){var b=0,c=0,d=f.stacked();for(var e in f.series){var g=f.series[e],h=g.accessor(a);c=d?c+h:h,b=c>b?c:b}return b},this.findMax=function(){var a=d3.max(this.data.getData(),this.seriesMax);return a},this.stacked=function(a){return arguments.length?(g=d3.functor(a),this):g()},this.calculateXPos=function(a,b){b.xPos||(b.xPos=0);var c=b.xPos;return b.xPos+=a(b),c},this.yPosition=function(a){return f.y.scale(f.keyFunction()(a))},this.calculateYPos=function(a,b){return b.yPos?b.yPos+=a:b.yPos=f.yPosition(b),b.yPos},this.xPosition=function(a){var b=f.currentSeries.accessor,c=f.stacked()?f.x.scale(f.calculateXPos(b,a)):0;return c},this.barThickness=function(a){return f.y.scale.rangeBand(a)},this.groupedbarThickness=function(a){var b=f.barThickness(a),c=f.stacked()||1==f.series.length?b:b/f.series.length;return c},this.offsetYPosition=function(a){var b=f.groupedbarThickness(a),c=f.stacked()?f.yPosition(a):f.calculateYPos(b,a);return c},this.barWidth=function(a){var b=f.currentSeries.accessor;return f.x.scale(b(a))};var j=function(a,b){var c=this.getAttribute("in_series"),d=i[c];f.mouseOver.call(this,a,b,d)};return this.seriesSpecificClassName=function(a){var b=" "+f.currentSeries.name+"class",c=f.itemClassName(a),d=c+b;return d},this.draw=function(a){f.initializeTooltip(a.container.node()),f.selectedItems=a.selectedItems,f.rootClassName=f.seriesClassName();var b=function(a){a.yPos=0,a.xPos=0},c=this.dataset(),d="g."+insight.Constants.BarGroupClass+"."+this.name,e=insight.Constants.BarGroupClass+" "+this.name,g="rect."+insight.Constants.BarGroupClass;c.forEach(b);var k=a.plotArea.selectAll(d).data(c,this.keyAccessor),l=k.enter().append("g").attr("class",e),m=l.selectAll(g),n=function(a){return f.click(this,a)},o=function(a,b){return 200+20*b};for(var p in this.series){this.currentSeries=this.series[p],h=this.currentSeries.name,i[h]=this.currentSeries.accessor;var q="."+h+"class."+insight.Constants.BarClass;m=l.append("rect").attr("class",f.seriesSpecificClassName).attr("height",0).attr("fill",this.currentSeries.color).attr("in_series",h).attr("clip-path","url(#"+a.clipPath()+")").on("mouseover",j).on("mouseout",this.mouseOut).on("click",n);{k.selectAll(q).transition().duration(o).attr("y",this.offsetYPosition).attr("x",this.xPosition).attr("height",this.groupedbarThickness).attr("width",this.barWidth)}}k.exit().remove()},this},insight.RowSeries.prototype=Object.create(insight.Series.prototype),insight.RowSeries.prototype.constructor=insight.RowSeries,insight.LineSeries=function(a,b,c,d,e){insight.Series.call(this,a,b,c,d,e);var f=this,g="linear",h=!0;this.classValues=[insight.Constants.LineClass];var i=function(){},j=function(){},k=function(){};this.showPoints=function(a){return arguments.length?(h=a,this):h},this.rangeY=function(a){return f.y.scale(f.valueFunction()(a))},this.rangeX=function(a){var b=0;return b=f.x.scale.rangeBand?f.x.scale(f.keyFunction()(a))+f.x.scale.rangeBand()/2:f.x.scale(f.keyFunction()(a))},this.lineType=function(a){return arguments.length?(g=a,this):g},this.draw=function(a,b){this.initializeTooltip(a.container.node());var c=d3.svg.line().x(f.rangeX).y(f.rangeY).interpolate(g),d=(this.dataset(),this.name+"line "+insight.Constants.LineClass),e="."+this.name+"line."+insight.Constants.LineClass,l="path"+e,m=a.plotArea.selectAll(l);this.rangeExists(m)||a.plotArea.append("path").attr("class",d).attr("stroke",this.color).attr("fill","none").attr("clip-path","url(#"+a.clipPath()+")").on("mouseover",i).on("mouseout",j).on("click",k);var n=b?0:300;if(a.plotArea.selectAll(l).datum(this.dataset(),this.matcher).transition().duration(n).attr("d",c),h){var o=a.plotArea.selectAll("circle").data(this.dataset());o.enter().append("circle").attr("class","target-point").attr("clip-path","url(#"+a.clipPath()+")").attr("cx",f.rangeX).attr("cy",a.height()-a.margin().bottom-a.margin().top).on("mouseover",f.mouseOver).on("mouseout",f.mouseOut),o.transition().duration(n).attr("cx",f.rangeX).attr("cy",f.rangeY).attr("r",3).attr("fill",this.color)}},this.rangeExists=function(a){return a[0].length}},insight.LineSeries.prototype=Object.create(insight.Series.prototype),insight.LineSeries.prototype.constructor=insight.LineSeries,insight.ColumnSeries=function(a,b,c,d,e){insight.Series.call(this,a,b,c,d,e);{var f=this,g=d3.functor(!1),h="",i={};this.x.rangeType}this.classValues=[insight.Constants.BarClass],this.series=[{name:"default",accessor:function(a){return f.valueFunction()(a)},tooltipValue:function(a){return f.tooltipFunction()(a)},color:d3.functor(e),label:"Value"}];this.seriesMax=function(a){var b=0,c=0,d=f.stacked();for(var e in f.series){var g=f.series[e],h=g.accessor(a);c=d?c+h:h,b=c>b?c:b}return b},this.findMax=function(){var a=d3.max(this.data.getData(),this.seriesMax);return a},this.stacked=function(a){return arguments.length?(g=d3.functor(a),this):g()},this.calculateYPos=function(a,b){return b.yPos||(b.yPos=0),b.yPos+=a(b),b.yPos},this.xPosition=function(a){return f.x.scale(f.keyFunction()(a))},this.calculateXPos=function(a,b){return b.xPos?b.xPos+=a:b.xPos=f.xPosition(b),b.xPos},this.yPosition=function(a){var b=f.currentSeries.accessor,c=f.y.scale(f.stackedBars()?f.calculateYPos(b,a):b(a));return c},this.barWidth=function(a){return f.x.scale.rangeBand(a)},this.groupedBarWidth=function(a){var b=f.barWidth(a),c=f.stackedBars()||1==f.series.length?b:b/f.series.length;return c},this.offsetXPosition=function(a){var b=f.groupedBarWidth(a),c=f.stackedBars()?f.xPosition(a):f.calculateXPos(b,a);return c},this.stackedBars=function(){return f.stacked()};var j=function(a){return f.click(this,a)},k=function(a,b){return 200+20*b},l=function(a,b){var c=this.getAttribute("in_series"),d=i[c];f.mouseOver.call(this,a,b,d)};return this.seriesSpecificClassName=function(a){var b=" "+f.currentSeries.name+"class",c=f.itemClassName(a),d=c+b;return d},this.draw=function(a){f.initializeTooltip(a.container.node()),f.selectedItems=a.selectedItems,f.rootClassName=f.seriesClassName();var b="g."+insight.Constants.BarGroupClass,c="rect."+insight.Constants.BarGroupClass,d=function(a){a.yPos=0,a.xPos=0},e=f.dataset();e.forEach(d);var g=a.plotArea.selectAll(b).data(e,f.keyAccessor),m=g.enter().append("g").attr("class",insight.Constants.BarGroupClass),n=m.selectAll(c),o=function(b){var c=f.currentSeries.accessor;return a.height()-a.margin().top-a.margin().bottom-f.y.scale(c(b))};for(var p in f.series){f.currentSeries=f.series[p],h=f.currentSeries.name,i[h]=f.currentSeries.accessor;var q="."+h+"class."+insight.Constants.BarClass;n=m.append("rect").attr("class",f.seriesSpecificClassName).attr("y",f.y.bounds[0]).attr("height",0).attr("in_series",h).attr("fill",f.currentSeries.color).attr("clip-path","url(#"+a.clipPath()+")").on("mouseover",l).on("mouseout",f.mouseOut).on("click",j);var r=g.selectAll(q);r.transition().duration(k).attr("y",f.yPosition).attr("x",f.offsetXPosition).attr("width",f.groupedBarWidth).attr("height",o)}g.exit().remove()},this},insight.ColumnSeries.prototype=Object.create(insight.Series.prototype),insight.ColumnSeries.prototype.constructor=insight.ColumnSeries,"function"==typeof define&&define.amd&&define("insight",[],function(){return insight});